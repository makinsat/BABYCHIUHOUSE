<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ä½ çš„è¨­å®šæª”
        const firebaseConfig = {
            apiKey: "AIzaSyCyJpNrkcVCefwq53wQDQZmZGhjOJpv27c",
            authDomain: "makinsat-36a6e.firebaseapp.com",
            projectId: "makinsat-36a6e",
            storageBucket: "makinsat-36a6e.firebasestorage.app",
            messagingSenderId: "213997948286",
            appId: "1:213997948286:web:116d44046db0f41a8e772f",
            measurementId: "G-8V2K5MLTDB"
        };

        const app = initializeApp(firebaseConfig);
        
        // ğŸš¨ é—œéµä¿®æ”¹ 1ï¼šé€™è£¡åŠ ä¸Šäº†ä½ çš„è³‡æ–™åº«åå­— "babychiu"
        const db = getFirestore(app, "babychiu"); 
        
        // ğŸš¨ é—œéµä¿®æ”¹ 2ï¼šé€™è£¡æ”¹æˆè·Ÿå¾Œå°ä¸€æ¨¡ä¸€æ¨£çš„ "USERs" (å¤§å¯« USER)
        const userRef = doc(db, "USERs", "ziling");

        const display = document.getElementById('points-display');
        const status = document.getElementById('status');
        const btn = document.getElementById('checkInBtn');

        // è®€å–é»æ•¸
        async function loadPoints() {
            try {
                const docSnap = await getDoc(userRef);
                if (docSnap.exists()) {
                    display.innerText = docSnap.data().points;
                    status.innerText = "é€£ç·šæˆåŠŸ âœ…";
                    btn.disabled = false;
                } else {
                    // å¦‚æœæ²’è³‡æ–™ï¼Œè‡ªå‹•å»ºç«‹
                    await setDoc(userRef, { points: 0 });
                    display.innerText = 0;
                    status.innerText = "æ–°å¸³æˆ¶å»ºç«‹å®Œæˆ";
                }
            } catch (error) {
                console.error("éŒ¯èª¤è©³æƒ…:", error); // é€™æ¨£å¯ä»¥åœ¨ Console çœ‹åˆ°æ›´è©³ç´°çš„éŒ¯èª¤
                status.innerText = "é€£ç·šå¤±æ•—";
            }
        }

        // ç°½åˆ°æŒ‰éˆ•åŠŸèƒ½
        btn.addEventListener('click', async () => {
            btn.disabled = true;
            btn.innerHTML = "å…¥å¸³ä¸­...";
            try {
                await updateDoc(userRef, {
                    points: increment(10),
                    last_checkin: new Date()
                });
                await loadPoints();
                alert("ğŸ‰ ç°½åˆ°æˆåŠŸï¼é»æ•¸å·²å…¥å¸³ï¼");
            } catch (error) {
                alert("éŒ¯èª¤ï¼š" + error.message);
            } finally {
                btn.innerHTML = "<span>ğŸ“…</span> æ¯æ—¥ç°½åˆ°é ˜å– (+10)";
                btn.disabled = false;
            }
        });

        loadPoints();
    </script>
