<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>VIP LOUNGE - Full Admin</title>
  
  <!-- 1. Â≠óÈ´îÊîπÁÇ∫ Montserrat (ÊîØÊè¥Á≤óÁ¥∞ËÆäÂåñ) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase Compat (Áµ±‰∏Ä‰ΩøÁî® 10.8.1) -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>

  <style>
    /* ÂÖ®Á´ôÂ≠óÈ´îËàáÈªëÈáëÈÖçËâ≤ËÆäÊï∏ */
    :root {
      --bg-dark: #121212;
      --card-dark: #1e1e1e;
      --text-main: #e5e5e5;
      --text-muted: #a3a3a3;
      --gold-main: #d4af37;
      --gold-light: #f1c40f;
    }

    /* ÊáâÁî® Montserrat Â≠óÈ´î */
    * { font-family: 'Montserrat', sans-serif !important; }
    
    body { 
      background-color: var(--bg-dark); 
      color: var(--text-main); 
      -webkit-tap-highlight-color: transparent; 
      font-weight: 400; 
      overflow-x: hidden; 
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    #root { opacity: 0; transition: opacity 0.5s ease-in; }
    #root.loaded { opacity: 1; }
    
    @keyframes floating { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    .animate-float { animation: floating 4s ease-in-out infinite; }
    
    /* ‰øùÊåÅÊñπÊ≠£È¢®Ê†º */
    img { display: block; max-width: 100%; height: auto; border-radius: 0px; }
    
    /* ÈªëÈáëÊº∏Â±§ËÉåÊôØ */
    .vip-gradient { background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); border-bottom: 1px solid #333; }
    .gold-text-gradient { background: linear-gradient(to right, #d4af37, #f1c40f); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 215, 0, 0.1); border-radius: 0; }
    
    /* ÂÖåÊèõÂà∏Ê®£Âºè - ÊñπÂΩ¢ */
    .coupon-card {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 0;
      position: relative;
      overflow: hidden;
      transition: all 0.4s ease;
    }
    .coupon-card::before, .coupon-card::after {
      content: '';
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--bg-dark);
      border-radius: 0;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      border: 1px solid #333;
    }
    .coupon-card::before { left: -6px; border-right: none; }
    .coupon-card::after { right: -6px; border-left: none; }

    .coupon-used { filter: grayscale(1); opacity: 0.5; border-color: #444; }

    /* ÈáëËâ≤ÊåâÈàïÊ®£Âºè - ÊñπÂΩ¢ */
    .btn-action {
      background: linear-gradient(135deg, #d4af37, #c5a028);
      color: #000;
      transition: all 0.3s ease;
      font-weight: 700;
      border-radius: 0;
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.1);
    }
    .btn-action:active { transform: scale(0.98); box-shadow: none; }
    .btn-action:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

    .log-item { border-bottom: 1px solid #333; }
    .log-item:last-child { border-bottom: none; }
    
    /* Ë∑ëÈ¶¨Ááà */
    .marquee { white-space: nowrap; overflow: hidden; box-sizing: border-box; }
    .marquee span { display: inline-block; padding-left: 100%; animation: marquee 15s linear infinite; }
    @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
    
    input, textarea { font-weight: 300 !important; color: white !important; border-radius: 0 !important; }
    button { font-weight: 600 !important; border-radius: 0 !important; }
    
    /* Range Slider (Ê©üÁéáË™øÊï¥Áî®) */
    input[type=range] { -webkit-appearance: none; background: transparent; }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; height: 16px; width: 16px; background: #d4af37; cursor: pointer; margin-top: -6px; border-radius: 0;
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%; height: 4px; cursor: pointer; background: #333;
    }

    /* Êí≤ÂÖãÁâåÊ®£Âºè */
    .card {
      width: 50px;
      height: 70px;
      background: white;
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 4px;
      font-weight: bold;
      font-size: 12px;
      color: black;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      position: relative;
    }
    .card.red { color: #e74c3c; }
    .card.hidden { 
      background: repeating-linear-gradient(45deg, #b71c1c, #b71c1c 5px, #c62828 5px, #c62828 10px);
      border: 2px solid white;
    }
    .card .suit { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; opacity: 0.2; }
    .card .val-top { align-self: flex-start; line-height: 1; }
    .card .val-bottom { align-self: flex-end; transform: rotate(180deg); line-height: 1; }

    /* Mines ÈÅäÊà≤Ê®£Âºè */
    .mines-grid {
      display: grid;
      gap: 8px;
      margin: 0 auto;
      width: 100%;
      max-width: 320px;
    }
    .mine-tile {
      width: 100%;
      padding-bottom: 100%; /* 1:1 Aspect Ratio Hack */
      background: #3a3a3a;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      border-bottom: 4px solid #222;
      transition: transform 0.1s ease, background 0.2s, border-color 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    .mine-tile:active { 
      transform: translateY(2px); 
      border-bottom-width: 2px;
      box-shadow: 0 2px 3px rgba(0,0,0,0.3);
    }
    .mine-tile.revealed { 
      background: #1a1a1a; 
      border-bottom: 2px solid #000; 
      cursor: default; 
      transform: translateY(2px);
      box-shadow: none;
    }
    .mine-tile.gem { 
      background: #112e1e; 
      border-bottom-color: #0b1f13; 
      border-color: #2ecc71; 
      border-width: 1px;
    }
    .mine-tile.mine { 
      background: #3e1212; 
      border-bottom-color: #2a0b0b; 
      border-color: #e74c3c; 
      border-width: 1px;
    }
    .mine-tile-inner {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mine-tile-inner .content { 
      font-size: 24px; 
      animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }
    @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    /* Dragonspire Ê®£Âºè */
    .dragon-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 8px;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.3s;
    }
    .dragon-row.active {
      background: rgba(212, 175, 55, 0.1);
      border: 1px solid #d4af37;
      box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
    }
    .dragon-row.locked {
      opacity: 0.3;
      filter: grayscale(1);
    }
    .dragon-row.cleared {
      opacity: 0.5;
    }
    .dragon-tile {
      height: 40px;
      background: #3a3a3a;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 3px solid #222;
      transition: all 0.1s;
    }
    .dragon-tile:active {
      transform: translateY(2px);
      border-bottom-width: 1px;
    }
    .dragon-tile.safe {
      background: #112e1e;
      border-color: #2ecc71;
      border-bottom-color: #0b1f13;
    }
    .dragon-tile.bad {
      background: #3e1212;
      border-color: #e74c3c;
      border-bottom-color: #2a0b0b;
    }

    /* Chicken Game Styles */
    .chicken-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr); 
      gap: 6px;
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
    }
    .chicken-tile {
      width: 100%;
      padding-bottom: 100%;
      background: #3a3a3a;
      border-radius: 50%;
      cursor: pointer;
      position: relative;
      border-bottom: 4px solid #222;
      transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    .chicken-tile:active {
      transform: translateY(2px);
      border-bottom-width: 2px;
    }
    .chicken-tile.revealed {
      background: #1a1a1a;
      border-bottom: 2px solid #000;
      cursor: default;
      transform: translateY(2px);
      box-shadow: none;
      border-radius: 10%;
    }
    .chicken-tile.win { background: #112e1e; border: 1px solid #f1c40f; }
    .chicken-tile.lose { background: #3e1212; border: 1px solid #e74c3c; }

    /* Cup Game Styles */
    .cups-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 40px;
      margin-bottom: 40px;
      height: 120px;
    }
    .cup-wrapper {
      position: relative;
      width: 70px;
      height: 80px;
      cursor: pointer;
      transition: transform 0.5s ease-in-out;
    }
    .cup {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 10;
      transition: transform 0.5s ease-out;
    }
    .cup-ball {
      position: absolute;
      bottom: 5px; left: 50%;
      transform: translateX(-50%);
      width: 20px; height: 20px;
      background: #f1c40f;
      border-radius: 50%;
      z-index: 5;
      box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }
    .cup-wrapper.lifted .cup {
      transform: translateY(-40px);
    }
    .cup-shuffling {
      animation: shuffle 0.5s ease-in-out infinite alternate;
    }
    @keyframes shuffle {
      0% { transform: translateX(0); }
      100% { transform: translateX(5px); }
    }
  </style>
</head>
<body>

  <div id="root"></div>

  <!-- Loading -->
  <div id="loading-screen" style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; color:#d4af37; font-weight:300; z-index:100;">
    <div class="animate-float" style="font-size: 40px; margin-bottom: 10px;">üëë</div>
    <div style="letter-spacing: 2px; font-size: 13px; color: #888;">LOADING VIP SYSTEM...</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, increment, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCyJpNrkcVCefwq53wQDQZmZGhjOJpv27c",
      authDomain: "makinsat-36a6e.firebaseapp.com",
      projectId: "makinsat-36a6e",
      storageBucket: "makinsat-36a6e.firebasestorage.app",
      messagingSenderId: "213997948286",
      appId: "1:213997948286:web:116d44046db0f41a8e772f",
      measurementId: "G-8V2K5MLTDB"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app, "babychiu");
    const finalAppId = "vip-lounge-v2"; 

    window.fb = { 
      db, auth, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, 
      increment, serverTimestamp, deleteDoc, appId: finalAppId, 
      signInAnonymously, onAuthStateChanged 
    };
  </script>

  <script type="text/babel">
    const { useState, useEffect, Fragment } = React;
    const { 
      db, auth, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, 
      increment, serverTimestamp, deleteDoc, appId,
      signInAnonymously, onAuthStateChanged 
    } = window.fb;

    // --- SVG Icons (‰øùÊåÅÊñπÊ≠£È¢®Ê†º) ---
    const Icon = ({ name, size = 24, className = "" }) => {
      const icons = {
        Point: <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />, 
        Home: (<Fragment><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Fragment>),
        Camera: (<Fragment><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Fragment>),
        Gift: (<Fragment><rect x="3" y="8" width="18" height="4" rx="0"/><path d="M12 8v13M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></Fragment>),
        Bell: (<Fragment><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></Fragment>),
        Lock: (<Fragment><rect x="3" y="11" width="18" height="11" rx="0"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Fragment>),
        LogOut: (<Fragment><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></Fragment>),
        Trash2: (<Fragment><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Fragment>),
        Ticket: (<Fragment><path d="M2 9V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 0 0 4v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 0 0-4Z"/><path d="M13 3v18M9 3v18M15 3v18"/></Fragment>),
        Store: (<Fragment><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/></Fragment>),
        Chart: (<Fragment><path d="M12 20V10M18 20V4M6 20v-4"/></Fragment>),
        Check: <polyline points="20 6 9 17 4 12"/>,
        Alert: (<Fragment><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Fragment>),
        History: (<Fragment><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></Fragment>),
        Sparkles: (<Fragment><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4M9 3v4M3 5h4M3 9h4"/></Fragment>),
        Image: (<Fragment><rect x="3" y="3" width="18" height="18" rx="0"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></Fragment>),
        Plus: (<Fragment><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Fragment>),
        User: (<Fragment><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></Fragment>),
        Dice: (<Fragment><rect x="3" y="3" width="18" height="18" rx="0"/><circle cx="8.5" cy="8.5" r="1.5"/><circle cx="15.5" cy="15.5" r="1.5"/><circle cx="15.5" cy="8.5" r="1.5"/><circle cx="8.5" cy="15.5" r="1.5"/><circle cx="12" cy="12" r="1.5"/></Fragment>),
        Droplet: (<Fragment><path d="M12 2.69l5.74 5.88a8.1 8.1 0 1 1-11.48 0L12 2.69z"/><path d="M12 22a7 7 0 0 1-7-7c0-2.32 1.15-4.36 2.87-5.59"/><path d="M12 8v8"/></Fragment>),
        Book: (<Fragment><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></Fragment>),
        Minus: <line x1="5" y1="12" x2="19" y2="12"/>,
        Cards: (<Fragment><rect x="6" y="2" width="12" height="16" rx="2" ry="2" /><line x1="9" y1="2" x2="9" y2="18" /><path d="M15 18l-3 3l-3 -3" /></Fragment>),
        Bomb: (<Fragment><circle cx="12" cy="12" r="6"/><path d="M11 2h2"/><path d="M12 2v4"/><path d="m7 7 2 2"/><path d="m15 7 2 2"/></Fragment>),
        Diamond: (<Fragment><path d="M6 3h12l4 6-10 13L2 9Z"/></Fragment>),
        Grid: (<Fragment><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></Fragment>),
        ChevronDown: <polyline points="6 9 12 15 18 9"/>,
        ChevronUp: <polyline points="18 15 12 9 6 15"/>,
        Flame: (<Fragment><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3a7 7 0 0 0 3 3.5z"/></Fragment>),
        Egg: (<Fragment><path d="M12 22c4.97 0 9-1.834 9-5.818C21 11.164 16.5 2 12 2S3 11.164 3 16.182C3 20.166 7.03 22 12 22z"/></Fragment>),
        Dragon: (<Fragment><path d="M2 14h20"/><path d="M4 10h16"/><path d="M6 6h12"/><path d="M8 2h8"/></Fragment>),
        Rooster: (<Fragment><path d="M12 22a2 2 0 0 0 2-2v-1h-4v1a2 2 0 0 0 2 2"/><path d="M12 2v4"/><path d="m9 6 3-3 3 3"/><path d="M12 6a5 5 0 0 1 5 5v3a5 5 0 0 1-5 5a5 5 0 0 1-5-5v-3a5 5 0 0 1 5-5"/><path d="M15 11h.01"/><path d="M9 11h.01"/></Fragment>),
        Bone: (<Fragment><path d="M17 19c2 0 3-1 3-3s-2-3-4-2l-8-5c-2-1-4 0-4 2s1 3 3 3l8 5"/></Fragment>),
        Cup: (<Fragment><path d="M5 8h14l-1.5 12h-11z"/><path d="M12 2l-2 6h4z"/></Fragment>),
        Ball: (<Fragment><circle cx="12" cy="12" r="10"/></Fragment>)
      };
      return (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
          {icons[name] || null}
        </svg>
      );
    };

    // Blackjack Logic Helpers
    const createDeck = () => {
      const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
      const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
      let deck = [];
      for (let s of suits) {
        for (let v of values) {
          deck.push({ suit: s, value: v, color: (s === '‚ô•' || s === '‚ô¶') ? 'red' : 'black' });
        }
      }
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    };

    const calculateHand = (hand) => {
      let sum = 0;
      let aces = 0;
      for (let card of hand) {
        if (['J', 'Q', 'K'].includes(card.value)) sum += 10;
        else if (card.value === 'A') { sum += 11; aces += 1; }
        else sum += parseInt(card.value);
      }
      while (sum > 21 && aces > 0) {
        sum -= 10;
        aces -= 1;
      }
      return sum;
    };

    const compressImage = (file) => {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 400; 
            const scale = MAX_WIDTH / img.width;
            canvas.width = MAX_WIDTH;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            resolve(canvas.toDataURL('image/jpeg', 0.5)); 
          };
        };
      });
    };

    function App() {
      const [user, setUser] = useState(null);
      const [activeTab, setActiveTab] = useState('dashboard');
      const [activeGame, setActiveGame] = useState(null); 
      const [isAdmin, setIsAdmin] = useState(false);
      const [points, setPoints] = useState(0);
      const [stats, setStats] = useState({ totalIssued: 0, totalRedeemed: 0 });
      // settings includes new adjustable parameters
      const [settings, setSettings] = useState({ 
        announce: 'Welcome to VIP Lounge', 
        lotteryProb: 0.1, 
        minesGridSize: 3,
        blackjackPayout: 1.0, 
        cupWinProb: 0.33, 
        cupMultiplier: 2.97 
      }); 
      const [submissions, setSubmissions] = useState([]);
      const [rewards, setRewards] = useState([]);
      const [notifications, setNotifications] = useState([]);
      const [announcement, setAnnouncement] = useState('Welcome to VIP Lounge üñ§');
      const [loading, setLoading] = useState(true);
      const [showNotifModal, setShowNotifModal] = useState(false); 

      // History Fold State
      const [showAllHistoryHome, setShowAllHistoryHome] = useState(false);
      const [showAllHistoryGames, setShowAllHistoryGames] = useState(false);

      // Task States
      const [desc, setDesc] = useState('');
      const [selectedFile, setSelectedFile] = useState(null);
      const [deedDesc, setDeedDesc] = useState('');
      const [deedFile, setDeedFile] = useState(null);
      const [isUploading, setIsUploading] = useState(false);
      const [isProcessing, setIsProcessing] = useState(false);
      const [adminPass, setAdminPass] = useState('');
      const [showAdminLogin, setShowAdminLogin] = useState(false);
      const [waterCount, setWaterCount] = useState(250);

      // Admin States
      const [adminRewardName, setAdminRewardName] = useState('');
      const [adminRewardCost, setAdminRewardCost] = useState('');
      const [adminRewardImage, setAdminRewardImage] = useState(null);
      const [isAddingReward, setIsAddingReward] = useState(false);
      const [approvalPoints, setApprovalPoints] = useState({});
      const [penaltyDesc, setPenaltyDesc] = useState('');
      const [penaltyAmount, setPenaltyAmount] = useState('');
      const [adminManualPoints, setAdminManualPoints] = useState('');
      const [adminManualReason, setAdminManualReason] = useState('');

      // Blackjack State
      const [bjDeck, setBjDeck] = useState([]);
      const [bjPlayerHand, setBjPlayerHand] = useState([]);
      const [bjDealerHand, setBjDealerHand] = useState([]);
      const [bjGameState, setBjGameState] = useState('betting'); 
      const [bjMessage, setBjMessage] = useState('');
      const [bjBet, setBjBet] = useState(0.25); // Fixed at 0.25

      // Cup Game State
      const [cupGameState, setCupGameState] = useState('betting'); // betting, shuffling, guessing, revealed
      const [cupBet, setCupBet] = useState('1'); 
      const [cupWinningIndex, setCupWinningIndex] = useState(null);
      const [cupSelectedIndex, setCupSelectedIndex] = useState(null);

      // Mines State
      const [minesCount, setMinesCount] = useState(1); 
      const [minesGrid, setMinesGrid] = useState([]); 
      const [minesStatus, setMinesStatus] = useState('idle');
      const [minesMultiplier, setMinesMultiplier] = useState(1);

      // Dragonspire State
      const [dsDifficulty, setDsDifficulty] = useState('normal'); 
      const [dsRows, setDsRows] = useState([]); 
      const [dsCurrentRowIndex, setDsCurrentRowIndex] = useState(0);
      const [dsStatus, setDsStatus] = useState('idle');
      const [dsMultiplier, setDsMultiplier] = useState(1);

      // Chicken State
      const [chickenGrid, setChickenGrid] = useState([]); 
      const [chickenBoneCount, setChickenBoneCount] = useState(5); 
      const [chickenStatus, setChickenStatus] = useState('idle');
      const [chickenMultiplier, setChickenMultiplier] = useState(1);
      
      const getPublicRef = (name) => collection(db, 'artifacts', appId, 'public', 'data', name);

      useEffect(() => {
        signInAnonymously(auth)
          .then(() => {})
          .catch((error) => {
            console.error("Auth Error (Fallback to Guest):", error);
            const guestUser = { uid: "guest_" + Math.random().toString(36).substring(7) };
            setUser(guestUser);
            setLoading(false);
            const ls = document.getElementById('loading-screen');
            if (ls) ls.style.display = 'none';
            const rt = document.getElementById('root');
            if (rt) rt.classList.add('loaded');
          });

        return onAuthStateChanged(auth, (u) => {
          if (u) {
            setUser(u);
            setLoading(false);
            const ls = document.getElementById('loading-screen');
            if (ls) ls.style.display = 'none';
            const rt = document.getElementById('root');
            if (rt) rt.classList.add('loaded');
          }
        });
      }, []);

      useEffect(() => {
        if (!user) return;
        
        const unsubStats = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), (d) => {
          if (d.exists()) {
            setPoints(d.data().totalPoints || 0);
            setStats({ totalIssued: d.data().totalIssued || 0, totalRedeemed: d.data().totalRedeemed || 0 });
          } else {
            setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: 0, totalIssued: 0, totalRedeemed: 0 });
          }
        });
        
        const unsubSettings = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), (d) => {
          if (d.exists()) {
            const data = d.data();
            setSettings({
              ...data,
              minesGridSize: data.minesGridSize || 3,
              blackjackPayout: data.blackjackPayout !== undefined ? data.blackjackPayout : 1.0,
              cupWinProb: data.cupWinProb !== undefined ? data.cupWinProb : 0.33,
              cupMultiplier: data.cupMultiplier !== undefined ? data.cupMultiplier : 2.97
            });
            setAnnouncement(data.announce || 'Welcome');
          } else {
            setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), { 
                announce: 'Welcome', 
                lotteryProb: 0.1, 
                minesGridSize: 3, 
                blackjackPayout: 1.0, 
                cupWinProb: 0.33, 
                cupMultiplier: 2.97 
            });
          }
        });

        const unsubSubs = onSnapshot(getPublicRef('submissions'), (s) => {
          const data = s.docs.map(d => ({id: d.id, ...d.data()}));
          data.sort((a, b) => (b.timestamp?.toMillis ? b.timestamp.toMillis() : Date.now()) - (a.timestamp?.toMillis ? a.timestamp.toMillis() : Date.now()));
          setSubmissions(data);
        });

        const unsubRewards = onSnapshot(getPublicRef('rewards'), (s) => {
          const data = s.docs.map(d => ({id: d.id, ...d.data()}));
          data.sort((a, b) => (a.available === b.available) ? (a.cost - b.cost) : (a.available ? -1 : 1));
          setRewards(data);
        });

        const unsubNotifs = onSnapshot(getPublicRef('notifications'), (s) => {
          const data = s.docs.map(d => ({id: d.id, ...d.data()}));
          data.sort((a, b) => (b.timestamp?.toMillis ? b.timestamp.toMillis() : Date.now()) - (a.timestamp?.toMillis ? a.timestamp.toMillis() : Date.now()));
          setNotifications(data);
        });
        return () => { unsubStats(); unsubSubs(); unsubRewards(); unsubNotifs(); unsubSettings(); };
      }, [user]);

      const deleteItem = async (e, colName, id, itemName) => {
        if (e && e.stopPropagation) e.stopPropagation();
        if (!confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${itemName}„ÄçÂóéÔºüÊ≠§Âãï‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ`)) return;
        try { 
          await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', colName, id)); 
        } catch (err) { alert("Âà™Èô§Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ"); }
      };

      const checkAdmin = () => {
        const secret = [53, 50, 48]; 
        const inputCodes = Array.from(adminPass).map(c => c.charCodeAt(0));
        if (JSON.stringify(secret) === JSON.stringify(inputCodes)) {
          setIsAdmin(true); setShowAdminLogin(false); setAdminPass(''); setActiveTab('admin');
        } else { alert('ÂØÜÁ¢ºÈåØË™§ üîí'); }
      };

      const handleManualPointAdjustment = async () => {
        if (!adminManualPoints || isNaN(adminManualPoints)) return alert("Ë´ãËº∏ÂÖ•ÊúâÊïàÊï∏Â≠ó");
        if (!adminManualReason.trim()) return alert("Ë´ãËº∏ÂÖ•ÂéüÂõ†");
        const pts = parseFloat(adminManualPoints);
        setIsProcessing(true);
        try {
            await addDoc(getPublicRef('submissions'), {
                description: `üîß ÁÆ°ÁêÜÂì°Ë™øÊï¥Ôºö${adminManualReason}`,
                status: pts >= 0 ? 'approved' : 'deducted',
                awardedPoints: pts,
                timestamp: serverTimestamp(),
                userId: user.uid
            });
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), {
                totalPoints: increment(pts),
                totalIssued: pts > 0 ? increment(pts) : increment(0),
                totalRedeemed: pts < 0 ? increment(Math.abs(pts)) : increment(0)
            });
            setAdminManualPoints(''); setAdminManualReason(''); alert(`Â∑≤ÊàêÂäüË™øÊï¥ ${pts} ÈªûÔºÅ`);
        } catch (e) { alert("Ë™øÊï¥Â§±Êïó"); } finally { setIsProcessing(false); }
      };

      // --- Cup Game Logic (Modified for Rigging) ---
      const startCupGame = async () => {
        const bet = parseFloat(cupBet);
        if(isNaN(bet) || bet <= 0) return alert("Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∏ãÊ≥®ÈáëÈ°ç");
        if(points < bet) return alert(`ÈªûÊï∏‰∏çË∂≥ÔºÅÈúÄË¶Å ${bet} P`);

        try {
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
                totalPoints: increment(-bet),
                totalRedeemed: increment(bet)
            });
            
            await addDoc(getPublicRef('submissions'), {
                description: `ü•õ ÁåúÊùØÂ≠êÔºö‰∏ãÊ≥®`,
                status: 'spent', 
                timestamp: serverTimestamp(),
                userId: user.uid,
                awardedPoints: -bet
            });

            // Initial visual placeholder, actual result determined on select
            setCupWinningIndex(Math.floor(Math.random() * 3));
            setCupSelectedIndex(null);
            setCupGameState('shuffling');

            setTimeout(() => {
                setCupGameState('guessing');
            }, 1000); 

        } catch(e) { alert("ÈÅäÊà≤ÂïüÂãïÂ§±Êïó"); }
      };

      const selectCup = async (index) => {
        if(cupGameState !== 'guessing') return;
        
        // Rigging Logic: Determine win based on configured probability
        const winProb = settings.cupWinProb !== undefined ? settings.cupWinProb : 0.33;
        const isWin = Math.random() < winProb;
        
        let finalWinIndex;
        if (isWin) {
            finalWinIndex = index; // Player wins
        } else {
            // Player loses, pick a random OTHER cup
            const otherCups = [0, 1, 2].filter(i => i !== index);
            finalWinIndex = otherCups[Math.floor(Math.random() * otherCups.length)];
        }

        setCupWinningIndex(finalWinIndex); // Update visual
        setCupSelectedIndex(index);
        setCupGameState('revealed');

        const bet = parseFloat(cupBet);
        const multiplier = settings.cupMultiplier !== undefined ? settings.cupMultiplier : 2.97;
        
        if (isWin) {
            const winAmount = bet * multiplier;
            try {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
                    totalPoints: increment(winAmount),
                    totalIssued: increment(winAmount - bet)
                });
                await addDoc(getPublicRef('submissions'), {
                    description: `ü•õ ÁåúÊùØÂ≠êÔºöÁç≤Âãù (x${multiplier})`,
                    status: 'won',
                    timestamp: serverTimestamp(),
                    userId: user.uid,
                    awardedPoints: winAmount
                });
            } catch(e) { console.error(e); }
        }
      };

      // --- Other Game Functions (Mines, Dragonspire, Chicken) ---
      const startMines = async () => { 
        const gridSize = settings.minesGridSize || 3;
        const totalTiles = gridSize * gridSize;
        let grid = Array(totalTiles).fill(null).map((_, i) => ({ id: i, isMine: false, revealed: false }));
        let minesPlaced = 0;
        const actualMinesCount = Math.min(minesCount, totalTiles - 1); 
        while (minesPlaced < actualMinesCount) {
          let idx = Math.floor(Math.random() * totalTiles);
          if (!grid[idx].isMine) { grid[idx].isMine = true; minesPlaced++; }
        }
        setMinesGrid(grid); setMinesStatus('playing'); setMinesMultiplier(1.0);
        try { await addDoc(getPublicRef('submissions'), { description: `üí£ MinesÔºöÈñãÂßãÈÅäÊà≤ (Free)`, status: 'spent', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
      };
      const clickTile = (index) => {
        if (minesStatus !== 'playing') { if(minesStatus === 'idle') alert('Ë´ãÂÖàÈªûÊìä‰∏ãÊñπÁöÑ„ÄåÈñãÂßãÈÅäÊà≤„ÄçÔºÅ'); return; }
        if (minesGrid[index].revealed) return;
        let newGrid = [...minesGrid];
        if (newGrid[index].isMine) {
          newGrid[index].revealed = true; setMinesStatus('exploded'); newGrid.forEach(t => t.revealed = true); setMinesGrid(newGrid);
        } else {
          newGrid[index].revealed = true; setMinesGrid(newGrid);
          const gridSize = settings.minesGridSize || 3;
          const totalTiles = gridSize * gridSize;
          const actualMinesCount = newGrid.filter(t => t.isMine).length;
          const currentRevealedCount = newGrid.filter(t => t.revealed && !t.isMine).length;
          const remainingTiles = totalTiles - (currentRevealedCount - 1); 
          const remainingSafe = totalTiles - actualMinesCount - (currentRevealedCount - 1);
          let nextMult = minesMultiplier * (remainingTiles / remainingSafe);
          setMinesMultiplier(nextMult);
        }
      };
      const cashOutMines = async () => {
        if (minesStatus !== 'playing') return;
        setMinesStatus('cashed_out'); const newGrid = [...minesGrid]; newGrid.forEach(t => t.revealed = true); setMinesGrid(newGrid);
        try { await addDoc(getPublicRef('submissions'), { description: `üí£ MinesÔºöÁç≤Âãù (x${minesMultiplier.toFixed(2)})`, status: 'won', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
      };

      const startDragonspire = async () => { 
        const rowCount = 9; const cols = 3; const newRows = []; const isHard = dsDifficulty === 'hard';
        for (let i = 0; i < rowCount; i++) {
          let rowTiles = []; let mineCount = isHard ? 2 : 1; let positions = [0, 1, 2];
          for (let j = positions.length - 1; j > 0; j--) { const k = Math.floor(Math.random() * (j + 1)); [positions[j], positions[k]] = [positions[k], positions[j]]; }
          let mines = positions.slice(0, mineCount);
          for(let c = 0; c < cols; c++) { rowTiles.push({ isMine: mines.includes(c), revealed: false }); }
          newRows.push({ tiles: rowTiles });
        }
        setDsRows(newRows); setDsCurrentRowIndex(0); setDsStatus('playing'); setDsMultiplier(1.0);
        try { await addDoc(getPublicRef('submissions'), { description: `üêâ DragonspireÔºöÈñãÂßãÈÅäÊà≤ (Free)`, status: 'spent', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
      };
      const clickDragonTile = (colIndex) => {
        if (dsStatus !== 'playing') return;
        const currentRow = dsRows[dsCurrentRowIndex]; if (currentRow.tiles.some(t => t.revealed)) return;
        let newRows = [...dsRows]; let tile = newRows[dsCurrentRowIndex].tiles[colIndex]; tile.revealed = true;
        if (tile.isMine) {
          setDsStatus('exploded'); newRows.forEach(row => row.tiles.forEach(t => { if (t.isMine) t.revealed = true; }));
        } else {
          const stepMult = dsDifficulty === 'normal' ? 1.45 : 2.90; const newMult = dsMultiplier * stepMult; setDsMultiplier(newMult);
          if (dsCurrentRowIndex === dsRows.length - 1) {
            setDsStatus('cashed_out'); try { addDoc(getPublicRef('submissions'), { description: `üêâ DragonspireÔºöÈÄöÈóúÁç≤Âãù (x${newMult.toFixed(2)})`, status: 'won', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
          } else { setDsCurrentRowIndex(dsCurrentRowIndex + 1); }
        }
        setDsRows(newRows);
      };
      const cashOutDragonspire = () => {
        if (dsStatus !== 'playing' || dsCurrentRowIndex === 0) return; setDsStatus('cashed_out');
        try { addDoc(getPublicRef('submissions'), { description: `üêâ DragonspireÔºö‰∏≠ÈÄîÈ†òÂèñ (x${dsMultiplier.toFixed(2)})`, status: 'won', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
      };

      const startChicken = async () => { 
        const totalTiles = 25; const bones = Math.min(Math.max(1, chickenBoneCount), 24);
        let grid = Array(totalTiles).fill(null).map((_, i) => ({ id: i, isBone: false, revealed: false }));
        let bonesPlaced = 0;
        while (bonesPlaced < bones) { let idx = Math.floor(Math.random() * totalTiles); if (!grid[idx].isBone) { grid[idx].isBone = true; bonesPlaced++; } }
        setChickenGrid(grid); setChickenStatus('playing'); setChickenMultiplier(1.0);
        try { await addDoc(getPublicRef('submissions'), { description: `üçó ChickenÔºöÈñãÂßãÈÅäÊà≤ (Free)`, status: 'spent', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
      };
      const clickChickenTile = (index) => {
        if (chickenStatus !== 'playing') return; if (chickenGrid[index].revealed) return;
        let newGrid = [...chickenGrid]; let tile = newGrid[index]; tile.revealed = true;
        if (tile.isBone) { setChickenStatus('lost'); newGrid.forEach(t => t.revealed = true); } 
        else {
          const totalTiles = 25; const totalBones = newGrid.filter(t => t.isBone).length; const revealedNonBones = newGrid.filter(t => t.revealed && !t.isBone).length;
          const remainingTiles = totalTiles - (revealedNonBones - 1); const remainingSafe = totalTiles - totalBones - (revealedNonBones - 1);
          let nextMult = chickenMultiplier * (remainingTiles / remainingSafe); setChickenMultiplier(nextMult);
        }
        setChickenGrid(newGrid);
      };
      const cashOutChicken = () => {
        if (chickenStatus !== 'playing') return; setChickenStatus('cashed_out'); const newGrid = [...chickenGrid]; newGrid.forEach(t => t.revealed = true); setChickenGrid(newGrid);
        try { addDoc(getPublicRef('submissions'), { description: `üçó ChickenÔºöÁç≤Âãù (x${chickenMultiplier.toFixed(2)})`, status: 'won', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: 0 }); } catch(e) {}
      };

      // --- Blackjack Functions ---
      const startBlackjack = async () => {
        const bet = 0.25; 
        if (points < bet) return alert(`ÈªûÊï∏‰∏çË∂≥ÔºÅÈúÄË¶Å ${bet} P`);
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(-bet), totalRedeemed: increment(bet) });
          await addDoc(getPublicRef('submissions'), { description: `‚ô†Ô∏è 21ÈªûÔºö‰∏ãÊ≥®`, status: 'spent', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: -bet });
          const newDeck = createDeck(); const pHand = [newDeck.pop(), newDeck.pop()]; const dHand = [newDeck.pop(), newDeck.pop()];
          setBjDeck(newDeck); setBjPlayerHand(pHand); setBjDealerHand(dHand);
          setBjBet(bet); setBjGameState('playing'); setBjMessage('');
          if (calculateHand(pHand) === 21) { finishBlackjack(pHand, dHand, bet, true); }
        } catch (e) { alert("ÈÅäÊà≤ÂïüÂãïÂ§±Êïó"); }
      };

      const hitBlackjack = () => {
        const newDeck = [...bjDeck]; const card = newDeck.pop(); const newHand = [...bjPlayerHand, card];
        setBjDeck(newDeck); setBjPlayerHand(newHand);
        if (calculateHand(newHand) > 21) { setBjGameState('gameOver'); setBjMessage('ÁàÜÁâå‰∫ÜÔºÅ(Bust) üí∏'); }
      };
      const standBlackjack = () => {
        let currentDeck = [...bjDeck]; let currentDHand = [...bjDealerHand];
        while (calculateHand(currentDHand) < 17) { currentDHand.push(currentDeck.pop()); }
        setBjDeck(currentDeck); setBjDealerHand(currentDHand); finishBlackjack(bjPlayerHand, currentDHand, bjBet, false);
      };
      const doubleBlackjack = async () => {
        if (bjPlayerHand.length !== 2) return;
        const extraCost = bjBet; 
        if (points < extraCost) return alert("ÈªûÊï∏‰∏çË∂≥ÔºåÁÑ°Ê≥ïÈõôÂÄç‰∏ãÊ≥®ÔºÅ");
        try {
           await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(-extraCost), totalRedeemed: increment(extraCost) });
           await addDoc(getPublicRef('submissions'), { description: `‚ô†Ô∏è 21ÈªûÔºöÈõôÂÄç‰∏ãÊ≥®`, status: 'spent', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: -extraCost });
           const newDeck = [...bjDeck]; const card = newDeck.pop(); const newHand = [...bjPlayerHand, card];
           let currentDHand = [...bjDealerHand];
           if (calculateHand(newHand) > 21) {
              setBjPlayerHand(newHand); setBjBet(bjBet + extraCost); setBjGameState('gameOver'); setBjMessage('ÈõôÂÄç‰∏ãÊ≥®...‰ΩÜÁàÜÁâå‰∫ÜÔºÅ üí∏'); return;
           }
           while (calculateHand(currentDHand) < 17) { currentDHand.push(newDeck.pop()); }
           setBjDeck(newDeck); setBjPlayerHand(newHand); setBjDealerHand(currentDHand); setBjBet(bjBet + extraCost);
           finishBlackjack(newHand, currentDHand, bjBet + extraCost, false);
        } catch(e) { alert("ÈõôÂÄç‰∏ãÊ≥®Â§±Êïó"); }
      };
      const finishBlackjack = async (pHand, dHand, currentBet, isNatural) => {
        const pScore = calculateHand(pHand); const dScore = calculateHand(dHand);
        let winAmount = 0; let msg = '';
        
        // Payout Multiplier Logic (Uses Admin Settings)
        const payoutRate = settings.blackjackPayout !== undefined ? settings.blackjackPayout : 1.0;

        if (pScore > 21) { msg = 'ÁàÜÁâå‰∫ÜÔºÅ‰Ω†Ëº∏‰∫Ü üí∏'; }
        else if (dScore > 21) { msg = 'ËéäÂÆ∂ÁàÜÁâåÔºÅ‰Ω†Ë¥è‰∫ÜÔºÅ üéâ'; winAmount = currentBet + (currentBet * payoutRate); }
        else if (pScore > dScore) { msg = '‰Ω†Ë¥è‰∫ÜÔºÅ üéâ'; winAmount = currentBet + (currentBet * payoutRate); }
        else if (pScore === dScore) { msg = 'Âπ≥Êâã (Push) ü§ù'; winAmount = currentBet; }
        else { msg = 'ËéäÂÆ∂Ë¥è‰∫Ü üí∏'; }
        
        setBjGameState('gameOver'); setBjMessage(msg);
        if (winAmount > 0) {
          try {
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(winAmount), totalIssued: increment(winAmount - currentBet) });
            await addDoc(getPublicRef('submissions'), { description: `‚ô†Ô∏è 21ÈªûÔºöÁç≤ÂãùÁçéÂãµ (${msg})`, status: 'won', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: winAmount });
          } catch(e) { console.error(e); }
        }
      };

      // --- Helper Functions ---
      const handleUploadTask = async () => {
        if (!desc.trim() || !selectedFile) return alert("Ë´ãËº∏ÂÖ•Ë™™Êòé‰∏¶‰∏äÂÇ≥ÁÖßÁâá ‚òÅÔ∏è");
        setIsUploading(true);
        try {
          const imgBase64 = await compressImage(selectedFile);
          await addDoc(getPublicRef('submissions'), {
            description: `üìñ Ëã±ÊñáÊâìÂç°Ôºö${desc}`, image: imgBase64, status: 'pending', timestamp: serverTimestamp(), userId: user.uid
          });
          setDesc(''); setSelectedFile(null); alert("ÊâìÂç°ÊàêÂäüÔºÅÁ≠âÂæÖÂ∫óÈï∑ÂØ©Ê†∏");
        } catch(e){ alert("Â§±Êïó"); } finally { setIsUploading(false); }
      };

      const handleGoodDeedTask = async () => {
        if (!deedDesc.trim() || !deedFile) return alert("Ë´ãËº∏ÂÖ•Ë™™Êòé‰∏¶‰∏äÂÇ≥ÁÖßÁâá üåü");
        setIsUploading(true);
        try {
          const imgBase64 = await compressImage(deedFile);
          await addDoc(getPublicRef('submissions'), {
            description: `üåü Â•Ω‰∫ãÊâìÂç°Ôºö${deedDesc}`, image: imgBase64, status: 'pending', timestamp: serverTimestamp(), userId: user.uid
          });
          setDeedDesc(''); setDeedFile(null); alert("Êèê‰∫§ÊàêÂäüÔºÅÁ≠âÂæÖÂ∫óÈï∑ÂØ©Ê†∏");
        } catch(e){ alert("Â§±Êïó"); } finally { setIsUploading(false); }
      };

      const handleWaterSubmit = async () => {
        if (waterCount <= 0) return alert("Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÊ∞¥Èáè üíß");
        setIsUploading(true); 
        try {
            await addDoc(getPublicRef('submissions'), {
                description: `üíß ÂñùÊ∞¥ÊâìÂç°Ôºö${waterCount}ml`,
                image: "https://cdn-icons-png.flaticon.com/512/3105/3105807.png", 
                status: 'pending',
                timestamp: serverTimestamp(),
                userId: user.uid
            });
            setWaterCount(250);
            alert("ÂñùÊ∞¥Á¥ÄÈåÑÂ∑≤ÈÄÅÂá∫ÔºÅÁ≠âÂæÖÂ∫óÈï∑ÁôºÈªûÊï∏ üíß");
        } catch(e) { alert("Â§±Êïó"); } finally { setIsUploading(false); }
      };

      const handleApprove = async (sub, customPoints) => {
        if (!customPoints || customPoints <= 0) return alert("Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈªûÊï∏");
        setIsProcessing(true);
        const pts = parseFloat(customPoints); 
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'submissions', sub.id), { status: 'approved', awardedPoints: pts });
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
            totalPoints: increment(pts),
            totalIssued: increment(pts)
          });
          setApprovalPoints(prev => ({...prev, [sub.id]: ''})); 
          alert(`ÊâπÂáÜÊàêÂäüÔºÅÂ∑≤ÁôºÊîæ ${pts} Èªû`);
        } catch(e) { alert("Â§±Êïó"); } finally { setIsProcessing(false); }
      };

      const updateSettings = async (updates) => {
        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), { 
          ...settings,
          ...updates
        }, { merge: true });
      };
      const handleAddRewardByAdmin = async () => {
        if (!adminRewardName || !adminRewardCost) return alert("Ë≥áË®ä‰∏çÂÖ®");
        setIsAddingReward(true);
        try {
          let img = "https://placehold.co/400x300/1e1e1e/d4af37?text=GIFT";
          if (adminRewardImage) img = await compressImage(adminRewardImage);
          await addDoc(getPublicRef('rewards'), { name: adminRewardName, image: img, cost: parseInt(adminRewardCost), available: true, timestamp: serverTimestamp() });
          setAdminRewardName(''); setAdminRewardCost(''); setAdminRewardImage(null); alert("ÂïÜÂìÅ‰∏äÊû∂ÊàêÂäüÔºÅüõí");
        } catch(e) { alert("Â§±Êïó"); } finally { setIsAddingReward(false); }
      };
      const handleRedeem = async (reward) => {
        if (points < Number(reward.cost)) return alert("ÈªûÊï∏‰∏çË∂≥ üíé");
        if (!confirm(`Á¢∫ÂÆöÂÖåÊèõ„Äå${reward.name}„ÄçÔºü`)) return;
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(-reward.cost), totalRedeemed: increment(reward.cost) });
          await addDoc(getPublicRef('submissions'), { description: `üéÅ Â∑≤ÂÖåÊèõÔºö${reward.name}`, image: reward.image, status: 'redeemed', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: -reward.cost });
          alert("ÂÖåÊèõÊàêÂäüÔºÅüéâ");
        } catch (e) { alert("Â§±Êïó"); }
      };
      const unreadCountReal = user ? notifications.filter(n => !n.readBy?.includes(user.uid)).length : 0;
      const gridSize = settings.minesGridSize || 3;
      const placeholderGrid = Array.from({ length: gridSize * gridSize });
      const renderTransactionHistory = (data, isExpanded, toggleFunc) => { 
        if (data.length === 0) return <p className="text-center text-[11px] text-[#444] py-6 italic">Â∞öÁÑ°Á¥ÄÈåÑ</p>;
        const displayData = isExpanded ? data : data.slice(0, 10);
        return (
          <div className="flex flex-col">
            {displayData.map(item => (
              <div key={item.id} className="log-item p-3 flex justify-between items-center">
                <div className="flex flex-col min-w-0">
                  <span className="text-[9px] text-[#666] font-bold uppercase">{item.timestamp?.toDate ? item.timestamp.toDate().toLocaleTimeString() : 'Just now'}</span>
                  <p className="text-xs font-medium text-[#ccc] truncate pr-2">{item.description}</p>
                </div>
                <div className={`text-sm font-bold shrink-0 ${item.awardedPoints > 0 ? 'text-[#2ed573]' : (item.awardedPoints < 0 ? 'text-[#ff4757]' : 'text-[#666]')}`}>
                  {item.awardedPoints > 0 ? `+${item.awardedPoints.toFixed(2)}` : (item.awardedPoints == 0 ? '--' : item.awardedPoints)}
                </div>
              </div>
            ))}
            {data.length > 10 && (
              <button onClick={toggleFunc} className="w-full py-3 text-xs text-[#d4af37] border-t border-[#333] hover:bg-[#222] transition-colors flex items-center justify-center gap-2">
                {isExpanded ? <><Icon name="ChevronUp" size={14}/> Êî∂Ëµ∑Á¥ÄÈåÑ</> : <><Icon name="ChevronDown" size={14}/> Êü•Áúã‰ª•Ââç‰∫§ÊòìÁ¥ÄÈåÑ ({data.length - 10} more)</>}
              </button>
            )}
          </div>
        );
      };

      if (loading) return null;

      return (
        <div className="max-w-md mx-auto shadow-2xl relative min-h-screen pb-24 sm:my-4 sm:border-2 sm:border-[#333] bg-[#121212] overflow-hidden flex flex-col no-scrollbar">
          
          {/* Header */}
          <div className="vip-gradient p-5 pb-7 text-white shadow-lg shrink-0 z-10 relative">
            <div className="flex justify-between items-center mb-5">
              <div className="flex items-center gap-2 border-l-4 border-[#d4af37] pl-3">
                <Icon name="Point" size={18} className="text-[#d4af37]" />
                <h1 className="text-xl font-bold tracking-widest uppercase italic gold-text-gradient">VIP CLUB</h1>
              </div>
              <div className="flex items-center gap-2">
                <button onClick={() => setShowNotifModal(true)} className="relative p-2 bg-white/5 transition-all hover:bg-white/10 rounded-none">
                  <Icon name="Bell" size={18} className="text-[#a3a3a3]" />
                  {unreadCountReal > 0 && <span className="absolute -top-1 -right-1 bg-red-600 text-white text-[8px] font-black w-4 h-4 flex items-center justify-center border border-[#121212] rounded-none">!</span>}
                </button>
                <button onClick={() => isAdmin ? setIsAdmin(false) : setShowAdminLogin(true)} className="p-2 bg-white/5 hover:bg-white/10 rounded-none">
                  <Icon name={isAdmin ? "LogOut" : "Lock"} size={18} className="text-[#a3a3a3]" />
                </button>
              </div>
            </div>
            
            {activeTab !== 'dashboard' && (
              <div className="flex justify-center mb-6">
                <div className="glass-card px-8 py-3 flex items-center gap-4 shadow-[0_0_20px_rgba(212,175,55,0.2)]">
                  <span className="text-4xl font-bold tracking-tight text-[#d4af37] drop-shadow-md">{parseFloat(points).toFixed(2)}</span>
                  <span className="text-[10px] font-bold text-[#888] uppercase tracking-[0.2em] border-l border-[#333] pl-4">Current<br/>Points</span>
                </div>
              </div>
            )}

            <div className="bg-[#1e1e1e] px-3 py-1.5 marquee mx-2 border border-[#333]">
              <span className="text-[11px] font-medium text-[#d4af37] tracking-wider">{announcement}</span>
            </div>
          </div>

          {/* Admin Login Modal */}
          {showAdminLogin && !isAdmin && (
            <div className="absolute inset-0 bg-black/80 z-[60] flex items-center justify-center animate-in backdrop-blur-sm">
              <div className="bg-[#1e1e1e] p-6 shadow-2xl w-72 border border-[#333] relative">
                <button onClick={() => setShowAdminLogin(false)} className="absolute top-2 right-2 text-[#666] p-2 hover:text-white">‚úï</button>
                <p className="text-[10px] font-bold mb-6 text-[#888] uppercase tracking-widest flex items-center gap-2 justify-center">
                    <Icon name="Lock" size={14}/> Security Access
                </p>
                <input type="password" placeholder="Passcode" className="w-full bg-[#121212] border border-[#333] p-3 mb-4 text-center text-lg text-white focus:border-[#d4af37] outline-none tracking-[0.5em]" value={adminPass} onChange={(e) => setAdminPass(e.target.value)} />
                <button onClick={checkAdmin} className="w-full btn-action py-3 text-xs shadow-lg">UNLOCK SYSTEM</button>
              </div>
            </div>
          )}

          {/* ÈÄöÁü•ÂΩàÁ™ó */}
          {showNotifModal && (
            <div className="absolute inset-0 bg-[#121212]/95 z-50 p-6 animate-in flex flex-col">
              <div className="flex justify-between items-center mb-6 border-b border-[#333] pb-4">
                <h2 className="text-lg font-bold text-[#e5e5e5] uppercase tracking-widest flex items-center gap-2"><Icon name="Bell" className="text-[#d4af37]"/> Ë®äÊÅØ‰∏≠ÂøÉ</h2>
                <button onClick={() => setShowNotifModal(false)} className="p-2 text-[#888]">ÈóúÈñâ X</button>
              </div>
              <div className="flex-1 overflow-y-auto space-y-4">
                {notifications.length === 0 && <p className="text-center text-[#444] mt-10">ÁõÆÂâçÊ≤íÊúâÊñ∞Ë®äÊÅØ</p>}
                {notifications.map(n => (
                  <div key={n.id} className={`p-5 bg-[#1e1e1e] border relative ${n.readBy?.includes(user.uid) ? 'opacity-50 border-[#333]' : 'border-[#d4af37]/50'}`}>
                    <button onClick={(e) => deleteItem(e, 'notifications', n.id, n.title)} className="absolute top-4 right-4 text-[#444] hover:text-red-500"><Icon name="Trash2" size={14} /></button>
                    <p className="font-bold text-sm text-[#e5e5e5] mb-2">{n.title}</p>
                    <p className="text-xs text-[#a3a3a3] leading-relaxed">{n.body}</p>
                  </div>
                ))}
              </div>
              <div className="mt-4 pt-4 border-t border-[#333]">
                  <button onClick={() => { if(confirm('Ê∏ÖÈô§ÊâÄÊúâÈÄöÁü•Ôºü')) notifications.forEach(n => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'notifications', n.id))); }} className="w-full text-xs text-[#444] py-3 border border-[#333] hover:bg-[#222]">Ê∏ÖÈô§ÊâÄÊúâË®äÊÅØ</button>
              </div>
            </div>
          )}

          <div className="p-5 flex-1 overflow-y-auto no-scrollbar">
            {activeTab === 'dashboard' && (
              <div className="space-y-8 animate-in">
                <div className="bg-gradient-to-br from-[#1e1e1e] to-[#000] p-8 border border-[#333] relative overflow-hidden shadow-2xl h-56 flex flex-col justify-between">
                  <div className="absolute top-0 right-0 w-32 h-32 bg-[#d4af37]/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                  <div className="flex justify-between items-start z-10">
                    <div>
                      <p className="text-[10px] text-[#666] tracking-[0.3em] font-bold mb-1">MEMBER CARD</p>
                      <h2 className="text-xl font-bold text-white tracking-widest italic">VIP LOUNGE</h2>
                    </div>
                    <Icon name="Point" size={32} className="text-[#d4af37]" />
                  </div>
                  <div className="z-10">
                    <p className="text-xs text-[#888] mb-1">TOTAL BALANCE</p>
                    <h1 className="text-5xl font-bold text-[#d4af37] tracking-tighter">{parseFloat(points).toFixed(2)}</h1>
                  </div>
                  <div className="flex justify-between items-end z-10 border-t border-[#333] pt-4">
                    <p className="text-[10px] text-[#444] font-mono">ID: {user?.uid?.substring(0,8).toUpperCase()}</p>
                    <p className="text-[10px] text-[#d4af37] font-bold">DIAMOND TIER</p>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-4">
                  <div onClick={() => setActiveTab('home')} className="bg-[#1e1e1e] p-6 border border-[#333] hover:border-[#d4af37] transition-all cursor-pointer group h-32 flex flex-col justify-between">
                    <Icon name="Plus" size={28} className="text-[#666] group-hover:text-[#d4af37] transition-colors" />
                    <div><h3 className="font-bold text-[#e5e5e5] text-sm">Ë≥∫ÂèñÈªûÊï∏</h3><p className="text-[10px] text-[#666] mt-1">ÊâìÂç°ËàáÁ¥ÄÈåÑ</p></div>
                  </div>
                  <div onClick={() => setActiveTab('games')} className="bg-[#1e1e1e] p-6 border border-[#333] hover:border-[#d4af37] transition-all cursor-pointer group h-32 flex flex-col justify-between">
                    <Icon name="Cards" size={28} className="text-[#666] group-hover:text-[#d4af37] transition-colors" />
                    <div><h3 className="font-bold text-[#e5e5e5] text-sm">ÈÅäÊà≤Â§ßÂª≥</h3><p className="text-[10px] text-[#666] mt-1">Mines Ëàá 21Èªû</p></div>
                  </div>
                </div>
                <div className="border-t border-[#333] pt-6">
                  <h3 className="text-xs font-bold text-[#666] mb-4 tracking-widest">SYSTEM STATUS</h3>
                  <div className="flex gap-4 overflow-x-auto no-scrollbar">
                    <div className="bg-[#111] p-4 border border-[#222] min-w-[120px] flex-shrink-0"><p className="text-[10px] text-[#444]">ISSUED</p><p className="text-lg font-bold text-[#e5e5e5]">{stats.totalIssued.toFixed(2)}</p></div>
                    <div className="bg-[#111] p-4 border border-[#222] min-w-[120px] flex-shrink-0"><p className="text-[10px] text-[#444]">REDEEMED</p><p className="text-lg font-bold text-[#e5e5e5]">{stats.totalRedeemed.toFixed(2)}</p></div>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'games' && (
              <div className="space-y-6 animate-in flex flex-col items-center justify-start h-full pb-10">
                {activeGame === null && (
                  <div className="w-full space-y-4">
                    <h2 className="text-lg font-bold text-[#e5e5e5] px-2 mb-4">ÈÅ∏ÊìáÈÅäÊà≤</h2>
                    
                    <div onClick={() => setActiveGame('blackjack')} className="bg-[#1e1e1e] border border-[#333] p-6 flex items-center justify-between cursor-pointer hover:border-[#d4af37] transition-all">
                      <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-[#222] flex items-center justify-center rounded-full border border-[#333]"><Icon name="Cards" size={24} className="text-[#d4af37]"/></div>
                        <div><h3 className="font-bold text-[#e5e5e5]">‰∫åÂçÅ‰∏ÄÈªû (21)</h3><p className="text-[10px] text-[#666]">ÂñÆÊ¨°‰∏ãÊ≥® 0.25 P</p></div>
                      </div>
                      <div className="text-right"><p className="text-xs font-bold text-[#d4af37]">Âõ∫ÂÆö‰∏ãÊ≥®</p><p className="text-[9px] text-[#444]">ENTRY</p></div>
                    </div>

                    <div onClick={() => setActiveGame('cups')} className="bg-[#1e1e1e] border border-[#333] p-6 flex items-center justify-between cursor-pointer hover:border-[#d4af37] transition-all">
                      <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-[#222] flex items-center justify-center rounded-full border border-[#333]"><Icon name="Cup" size={24} className="text-[#3498db]"/></div>
                        <div><h3 className="font-bold text-[#e5e5e5]">ÁåúÊùØÂ≠ê (Shell Game)</h3><p className="text-[10px] text-[#666]">‰∏âÈÅ∏‰∏ÄÔºåÁåú‰∏≠ÁêÉÂú®Âì™Ë£°</p></div>
                      </div>
                      <div className="text-right"><p className="text-xs font-bold text-[#d4af37]">Ëá™Ë®Ç‰∏ãÊ≥®</p><p className="text-[9px] text-[#444]">ENTRY</p></div>
                    </div>

                    <div onClick={() => setActiveGame('mines')} className="bg-[#1e1e1e] border border-[#333] p-6 flex items-center justify-between cursor-pointer hover:border-[#d4af37] transition-all">
                      <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-[#222] flex items-center justify-center rounded-full border border-[#333]"><Icon name="Bomb" size={24} className="text-red-500"/></div>
                        <div><h3 className="font-bold text-[#e5e5e5]">Mines (ÊéÉÈõ∑)</h3><p className="text-[10px] text-[#666]">Free Play Mode</p></div>
                      </div>
                      <div className="text-right"><p className="text-xs font-bold text-[#2ecc71]">Á¥îÂ®õÊ®Ç</p></div>
                    </div>

                    <div onClick={() => setActiveGame('dragonspire')} className="bg-[#1e1e1e] border border-[#333] p-6 flex items-center justify-between cursor-pointer hover:border-[#d4af37] transition-all">
                      <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-[#222] flex items-center justify-center rounded-full border border-[#333]"><Icon name="Dragon" size={24} className="text-[#3498db]"/></div>
                        <div><h3 className="font-bold text-[#e5e5e5]">Dragonspire</h3><p className="text-[10px] text-[#666]">Free Play Mode</p></div>
                      </div>
                      <div className="text-right"><p className="text-xs font-bold text-[#2ecc71]">Á¥îÂ®õÊ®Ç</p></div>
                    </div>

                    <div onClick={() => setActiveGame('chicken')} className="bg-[#1e1e1e] border border-[#333] p-6 flex items-center justify-between cursor-pointer hover:border-[#d4af37] transition-all">
                      <div className="flex items-center gap-4">
                        <div className="w-12 h-12 bg-[#222] flex items-center justify-center rounded-full border border-[#333]"><Icon name="Rooster" size={24} className="text-[#f1c40f]"/></div>
                        <div><h3 className="font-bold text-[#e5e5e5]">Chicken</h3><p className="text-[10px] text-[#666]">Free Play Mode</p></div>
                      </div>
                      <div className="text-right"><p className="text-xs font-bold text-[#2ecc71]">Á¥îÂ®õÊ®Ç</p></div>
                    </div>
                  </div>
                )}

                {activeGame === 'cups' && (
                  <div className="w-full bg-[#1e1e1e] p-6 border border-[#333] shadow-lg flex flex-col gap-4 animate-in">
                    <div className="flex justify-between items-center border-b border-[#333] pb-3">
                      <div className="flex items-center gap-2">
                        <button onClick={() => setActiveGame(null)} className="text-[#666] hover:text-white mr-2">‚Üê</button>
                        <h2 className="text-lg font-bold text-[#d4af37] flex items-center gap-2"><Icon name="Cup" size={20}/> ÁåúÊùØÂ≠ê</h2>
                      </div>
                      <span className="text-xs text-[#666]">{cupGameState === 'betting' ? 'Ê∫ñÂÇô‰∏≠' : (cupGameState === 'revealed' ? (cupSelectedIndex === cupWinningIndex ? 'Áç≤Âãù!' : 'Â§±Êïó') : 'ÈÄ≤Ë°å‰∏≠')}</span>
                    </div>
                    <div className="cups-container relative">
                        {[0, 1, 2].map((i) => (
                            <div key={i} className={`cup-wrapper ${cupGameState === 'shuffling' ? 'cup-shuffling' : ''} ${cupGameState === 'revealed' && (i === cupWinningIndex || i === cupSelectedIndex) ? 'lifted' : ''}`} onClick={() => selectCup(i)} style={{ animationDelay: `${i * 0.1}s` }}>
                                <div className="cup bg-[#333] border border-[#555] flex items-center justify-center rounded-t-lg shadow-lg"><span className="text-[#666] text-xs font-bold opacity-30">{i + 1}</span></div>
                                {cupGameState !== 'betting' && i === cupWinningIndex && (<div className="cup-ball"></div>)}
                            </div>
                        ))}
                    </div>
                    {cupGameState === 'betting' || cupGameState === 'revealed' ? (
                        <div className="space-y-3">
                            {cupGameState === 'revealed' && (<p className={`text-center font-bold text-sm ${cupSelectedIndex === cupWinningIndex ? 'text-[#2ecc71]' : 'text-red-500'}`}>{cupSelectedIndex === cupWinningIndex ? `ÊÅ≠ÂñúÁåú‰∏≠ÔºÅ (+${(parseFloat(cupBet) * (settings.cupMultiplier || 2.97)).toFixed(2)})` : 'ÁåúÈåØ‰∫ÜÔºåÁêÉÂú®Âà•ÁöÑÂú∞Êñπ'}</p>)}
                            <div className="flex items-center gap-2 border border-[#333] bg-[#121212] p-2"><span className="text-[#666] text-xs font-bold">$</span><input type="number" value={cupBet} onChange={(e) => setCupBet(e.target.value)} className="w-full bg-transparent text-white text-sm outline-none font-mono" placeholder="Ëº∏ÂÖ•‰∏ãÊ≥®ÈáëÈ°ç"/></div>
                            <button onClick={startCupGame} className="w-full btn-action py-3 text-xs tracking-widest">{cupGameState === 'revealed' ? 'ÂÜçÁé©‰∏ÄÊ¨°' : `ÈñãÂßãÊ¥óÁâå (x${settings.cupMultiplier || 2.97})`}</button>
                        </div>
                    ) : (<p className="text-center text-[#d4af37] text-sm animate-pulse">{cupGameState === 'shuffling' ? 'Ê¥óÁâå‰∏≠...' : 'Ë´ãÈÅ∏Êìá‰∏ÄÂÄãÊùØÂ≠êÔºÅ'}</p>)}
                    
                    {/* Game History for Cup Game */}
                    <div className="w-full space-y-3 mt-4">
                      <h3 className="text-[10px] font-bold text-[#666] uppercase tracking-[0.2em] px-2 flex items-center gap-2"><Icon name="History" size={14} className="text-[#d4af37]"/> ÈÅäÊà≤Á¥ÄÈåÑ</h3>
                      <div className="bg-[#1e1e1e] border border-[#333] overflow-hidden">
                        {renderTransactionHistory(
                          submissions.filter(s => s.description && s.description.includes('ÁåúÊùØÂ≠ê')),
                          showAllHistoryGames,
                          () => setShowAllHistoryGames(!showAllHistoryGames)
                        )}
                      </div>
                    </div>
                  </div>
                )}

                {activeGame === 'blackjack' && (
                  <div className="w-full bg-[#1e1e1e] p-6 border border-[#333] shadow-lg flex flex-col gap-4 animate-in">
                    <div className="flex justify-between items-center border-b border-[#333] pb-3">
                      <div className="flex items-center gap-2">
                        <button onClick={() => setActiveGame(null)} className="text-[#666] hover:text-white mr-2">‚Üê</button>
                        <h2 className="text-lg font-bold text-[#d4af37] flex items-center gap-2"><Icon name="Cards" size={20}/> BLACKJACK</h2>
                      </div>
                      <span className="text-xs text-[#666]">Fixed Bet: 0.25</span>
                    </div>
                    <div className="flex flex-col items-center gap-2"><p className="text-[10px] text-[#888] uppercase tracking-widest">Dealer</p><div className="flex gap-2">{bjGameState === 'betting' ? (<div className="w-12 h-16 border border-[#333] rounded bg-[#222] flex items-center justify-center text-[#444] text-xs">Empty</div>) : (bjDealerHand.map((card, i) => (<div key={i} className={`card ${card.color} ${i === 0 && bjGameState === 'playing' ? 'hidden' : ''}`}>{i === 0 && bjGameState === 'playing' ? '' : (<><span className="val-top">{card.value}<br/>{card.suit}</span><span className="suit">{card.suit}</span><span className="val-bottom">{card.value}<br/>{card.suit}</span></>)}</div>)))}</div><p className="text-xs text-[#e5e5e5] font-mono h-4">{bjGameState !== 'betting' && bjGameState !== 'playing' ? calculateHand(bjDealerHand) : ''}</p></div>
                    <div className="h-8 flex items-center justify-center"><span className="text-sm font-bold text-[#d4af37] animate-bounce">{bjMessage}</span></div>
                    <div className="flex flex-col items-center gap-2"><p className="text-xs text-[#e5e5e5] font-mono h-4">{bjGameState !== 'betting' ? calculateHand(bjPlayerHand) : ''}</p><div className="flex gap-2">{bjGameState === 'betting' ? (<div className="w-12 h-16 border border-[#333] rounded bg-[#222] flex items-center justify-center text-[#444] text-xs">Empty</div>) : (bjPlayerHand.map((card, i) => (<div key={i} className={`card ${card.color}`}><span className="val-top">{card.value}<br/>{card.suit}</span><span className="suit">{card.suit}</span><span className="val-bottom">{card.value}<br/>{card.suit}</span></div>)))}</div><p className="text-[10px] text-[#888] uppercase tracking-widest">You</p></div>
                    <div className="grid grid-cols-2 gap-3 mt-2">
                      {bjGameState === 'betting' || bjGameState === 'gameOver' ? (
                        <div className="col-span-2 space-y-3">
                            <div className="flex items-center justify-between border border-[#333] bg-[#121212] p-3">
                                <span className="text-[#666] text-xs font-bold">‰∏ãÊ≥®ÈáëÈ°ç</span>
                                <span className="text-[#d4af37] text-sm font-mono font-bold">0.25 P</span>
                            </div>
                            <button onClick={startBlackjack} className="w-full btn-action py-3 text-xs tracking-widest">ÁôºÁâå (Deal)</button>
                        </div>
                      ) : (<><button onClick={hitBlackjack} className="bg-[#333] text-white py-3 text-xs font-bold border border-[#444] hover:bg-[#444]">Ë¶ÅÁâå (Hit)</button><button onClick={standBlackjack} className="btn-action py-3 text-xs font-bold">ÂÅúÁâå (Stand)</button>{bjPlayerHand.length === 2 && (<button onClick={doubleBlackjack} className="col-span-2 bg-[#d4af37]/20 text-[#d4af37] border border-[#d4af37] py-3 text-xs font-bold hover:bg-[#d4af37]/40">ÈõôÂÄç‰∏ãÊ≥® (Double) - 0.25 P</button>)}</>)}
                    </div>

                    {/* Game History for Blackjack - ADDED */}
                    <div className="w-full space-y-3 mt-4">
                      <h3 className="text-[10px] font-bold text-[#666] uppercase tracking-[0.2em] px-2 flex items-center gap-2"><Icon name="History" size={14} className="text-[#d4af37]"/> ÈÅäÊà≤Á¥ÄÈåÑ</h3>
                      <div className="bg-[#1e1e1e] border border-[#333] overflow-hidden">
                        {renderTransactionHistory(
                          submissions.filter(s => s.description && s.description.includes('21Èªû')),
                          showAllHistoryGames,
                          () => setShowAllHistoryGames(!showAllHistoryGames)
                        )}
                      </div>
                    </div>
                  </div>
                )}

                {/* Other Games */}
                {activeGame === 'mines' && (
                  <div className="w-full flex flex-col items-center gap-6 animate-in">
                    <button onClick={() => { if(minesStatus === 'playing') return; setActiveGame(null); }} className="self-start text-[#666] text-xs hover:text-white mb-2">‚Üê ËøîÂõûÂ§ßÂª≥</button>
                    <div className="w-full bg-[#1e1e1e] p-6 border border-[#333] shadow-lg flex flex-col gap-4">
                      <div className="flex justify-between items-center border-b border-[#333] pb-3"><h2 className="text-lg font-bold text-[#d4af37] flex items-center gap-2"><Icon name="Bomb" size={20}/> MINES <span className="text-[10px] text-[#666] bg-[#222] px-2 py-0.5 rounded ml-2">FREE</span></h2><div className="text-right">{minesStatus === 'playing' ? <span className="text-sm font-bold text-[#2ecc71]">x{minesMultiplier.toFixed(2)}</span> : <span className="text-xs text-[#666]">Á¥îÂ®õÊ®Ç</span>}</div></div>
                      {minesStatus === 'idle' || minesStatus === 'cashed_out' || minesStatus === 'exploded' ? (<div className="space-y-4"><div className="flex justify-between items-center"><span className="text-xs text-[#888]">Mines: {minesCount}</span><div className="flex gap-1">{[1, 3, 5, 8].map(n=><button key={n} onClick={()=>setMinesCount(n)} className={`px-2 py-1 text-[10px] border ${minesCount===n?'bg-[#d4af37] text-black':'text-[#666]'}`}>{n}</button>)}</div></div><button onClick={startMines} className="btn-action w-full py-4 text-sm font-bold">Start Free Game</button></div>) : (<div className="text-center"><button onClick={cashOutMines} className="w-full btn-action py-3 text-xs font-bold">Cashout (x{minesMultiplier.toFixed(2)})</button></div>)}
                      <div className="mines-grid mt-4" style={{ gridTemplateColumns: `repeat(${settings.minesGridSize || 3}, 1fr)` }}>{(minesGrid.length>0?minesGrid:placeholderGrid).map((tile, i) => (<div key={i} onClick={() => minesGrid.length>0 && clickTile(i)} className={`mine-tile ${tile.revealed?(tile.isMine?'mine':'gem'):''} ${!tile.revealed&&minesStatus==='playing'?'hover:bg-[#444]':''}`}>{tile.revealed && <div className="mine-tile-inner"><div className="content">{tile.isMine?<Icon name="Bomb" size={24} className="text-red-500"/>:<Icon name="Diamond" size={24} className="text-green-500"/>}</div></div>}</div>))}</div>
                    </div>
                  </div>
                )}
                {activeGame === 'dragonspire' && (
                    <div className="w-full flex flex-col items-center gap-6 animate-in">
                        <button onClick={() => { if(dsStatus === 'playing') return; setActiveGame(null); }} className="self-start text-[#666] text-xs hover:text-white mb-2">‚Üê ËøîÂõûÂ§ßÂª≥</button>
                        <div className="w-full bg-[#1e1e1e] p-6 border border-[#333] shadow-lg flex flex-col gap-4">
                            <h2 className="text-lg font-bold text-[#d4af37] flex items-center gap-2"><Icon name="Dragon" size={20}/> DRAGONSPIRE <span className="text-[10px] text-[#666] bg-[#222] px-2 py-0.5 rounded ml-2">FREE</span></h2>
                            {dsStatus === 'idle' || dsStatus === 'exploded' || dsStatus === 'cashed_out' ? (
                                <div className="space-y-4"><div className="flex gap-2"><button onClick={()=>setDsDifficulty('normal')} className="flex-1 py-2 text-xs border border-[#333] text-[#666]">Normal</button><button onClick={()=>setDsDifficulty('hard')} className="flex-1 py-2 text-xs border border-[#333] text-[#666]">Hard</button></div><button onClick={startDragonspire} className="btn-action w-full py-4 text-sm font-bold">Start</button></div>
                            ) : (<button onClick={cashOutDragonspire} disabled={dsCurrentRowIndex===0} className="btn-action w-full py-3 text-xs font-bold">Cashout (x{dsMultiplier.toFixed(2)})</button>)}
                            <div className="mt-4 flex flex-col-reverse gap-2 max-w-[200px] mx-auto w-full">{dsRows.map((row,r)=><div key={r} className={`dragon-row ${r===dsCurrentRowIndex&&dsStatus==='playing'?'active':''} ${r<dsCurrentRowIndex?'cleared':''} ${r>dsCurrentRowIndex?'locked':''}`}>{row.tiles.map((t,c)=><div key={c} onClick={()=>r===dsCurrentRowIndex&&clickDragonTile(c)} className={`dragon-tile ${t.revealed?(t.isMine?'bad':'safe'):''}`}>{t.revealed&&(t.isMine?<Icon name="Flame" className="text-red-500"/>:<Icon name="Egg" className="text-green-500"/>)}</div>)}</div>)}</div>
                        </div>
                    </div>
                )}
                {activeGame === 'chicken' && (
                    <div className="w-full flex flex-col items-center gap-6 animate-in">
                        <button onClick={() => { if(chickenStatus === 'playing') return; setActiveGame(null); }} className="self-start text-[#666] text-xs hover:text-white mb-2">‚Üê ËøîÂõûÂ§ßÂª≥</button>
                        <div className="w-full bg-[#1e1e1e] p-6 border border-[#333] shadow-lg flex flex-col gap-4">
                            <h2 className="text-lg font-bold text-[#d4af37] flex items-center gap-2"><Icon name="Rooster" size={20}/> CHICKEN <span className="text-[10px] text-[#666] bg-[#222] px-2 py-0.5 rounded ml-2">FREE</span></h2>
                            {chickenStatus==='idle'||chickenStatus==='cashed_out'||chickenStatus==='lost'?(<div className="space-y-4"><div className="flex justify-between text-xs text-[#666]"><span>Bones: {chickenBoneCount}</span></div><button onClick={startChicken} className="btn-action w-full py-4 text-sm font-bold">Start</button></div>):(<button onClick={cashOutChicken} className="btn-action w-full py-3 text-xs font-bold">Cashout (x{chickenMultiplier.toFixed(2)})</button>)}
                            <div className="chicken-grid mt-4">{chickenGrid.map((t,i)=><div key={i} onClick={()=>clickChickenTile(i)} className={`chicken-tile ${t.revealed?(t.isBone?'lose':'win'):''}`}>{t.revealed&&<div className="mine-tile-inner"><div className="content">{t.isBone?<Icon name="Bone" className="text-red-500"/>:<Icon name="Rooster" className="text-yellow-500"/>}</div></div>}</div>)}</div>
                        </div>
                    </div>
                )}
              </div>
            )}

            {/* Home Tab - RESTORED FULL FUNCTIONALITY */}
            {activeTab === 'home' && (
                <div className="space-y-6 animate-in pb-10">
                    
                    {/* Good Deed Task */}
                    <div className="bg-[#1e1e1e] p-6 border border-[#333] shadow-lg relative overflow-hidden">
                      <div className="absolute top-0 right-0 w-24 h-24 bg-[#d4af37]/5 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2"></div>
                      <h3 className="font-bold text-[#e5e5e5] mb-5 flex gap-2 items-center tracking-wide"><Icon name="Sparkles" size={18} className="text-[#f1c40f]"/> üåü Â•Ω‰∫ãÊâìÂç°ÂçÄ</h3>
                      <textarea className="w-full bg-[#121212] p-4 border border-[#333] text-sm min-h-[90px] outline-none focus:border-[#f1c40f] transition-all text-[#e5e5e5]" placeholder="‰ªäÂ§©ÂÅö‰∫Ü‰ªÄÈ∫ºÂæàÊ£íÁöÑ‰∫ãÊÉÖ..." value={deedDesc} onChange={(e) => setDeedDesc(e.target.value)} />
                      <div className="flex gap-3 mt-5">
                        <label className={`flex-[1.5] cursor-pointer py-3.5 flex items-center justify-center border transition-all ${deedFile ? 'border-[#f1c40f] bg-[#f1c40f]/10 text-[#f1c40f]' : 'border-[#333] bg-[#121212] text-[#666] hover:border-[#555]'}`}>
                          <Icon name="Image" size={16} className="mr-2"/> <span className="text-xs font-bold">{deedFile ? 'Â∑≤ÈÅ∏Êìá' : '‰∏äÂÇ≥ÁÖßÁâá'}</span>
                          <input type="file" accept="image/*" className="hidden" onChange={(e) => setDeedFile(e.target.files[0])} />
                        </label>
                        <button onClick={handleGoodDeedTask} disabled={isUploading} className="flex-1 btn-action py-3.5 text-xs bg-gradient-to-r from-[#f1c40f] to-[#f39c12]">Êèê‰∫§Â•Ω‰∫ã</button>
                      </div>
                    </div>

                    {/* English Task */}
                    <div className="bg-[#1e1e1e] p-6 border border-[#333] shadow-lg relative overflow-hidden">
                      <h3 className="font-bold text-[#e5e5e5] mb-5 flex gap-2 items-center tracking-wide"><Icon name="Book" size={18} className="text-[#d4af37]"/> Ëã±ÊñáÊâìÂç°ÂçÄ</h3>
                      <textarea className="w-full bg-[#121212] p-4 border border-[#333] text-sm min-h-[90px] outline-none focus:border-[#d4af37] transition-all text-[#e5e5e5]" placeholder="‰ªäÂ§©ËÆÄ‰∫Ü‰ªÄÈ∫ºËã±Êñá..." value={desc} onChange={(e) => setDesc(e.target.value)} />
                      <div className="flex gap-3 mt-5">
                        <label className={`flex-[1.5] cursor-pointer py-3.5 flex items-center justify-center border transition-all ${selectedFile ? 'border-[#d4af37] bg-[#d4af37]/10 text-[#d4af37]' : 'border-[#333] bg-[#121212] text-[#666] hover:border-[#555]'}`}>
                          <Icon name="Image" size={16} className="mr-2"/> <span className="text-xs font-bold">{selectedFile ? 'Â∑≤ÈÅ∏Êìá' : '‰∏äÂÇ≥Ë≠âÊòé'}</span>
                          <input type="file" accept="image/*" className="hidden" onChange={(e) => setSelectedFile(e.target.files[0])} />
                        </label>
                        <button onClick={handleUploadTask} disabled={isUploading} className="flex-1 btn-action py-3.5 text-xs">Êèê‰∫§ÊâìÂç°</button>
                      </div>
                    </div>

                    {/* Water Task */}
                    <div className="bg-[#1e1e1e] p-6 border border-[#333] shadow-lg relative overflow-hidden group">
                      <div className="absolute -right-6 -top-6 text-[#d4af37]/10 transform rotate-12 group-hover:rotate-0 transition-all duration-700">
                        <Icon name="Droplet" size={120} />
                      </div>
                      <h3 className="font-bold text-[#e5e5e5] mb-6 flex gap-2 items-center tracking-wide relative z-10">
                        <Icon name="Droplet" size={18} className="text-[#3498db]"/> ÂñùÊ∞¥ÊâìÂç°ÂçÄ
                      </h3>
                      <div className="flex flex-col items-center justify-center mb-6 relative z-10">
                        <div className="text-5xl font-bold text-[#3498db] mb-1 font-mono">{waterCount}<span className="text-lg ml-1 text-[#666]">ml</span></div>
                        <p className="text-[10px] text-[#666] tracking-widest uppercase">Êú¨Ê¨°ÊîùÂèñÈáè</p>
                      </div>
                      <div className="grid grid-cols-4 gap-2 mb-6 relative z-10">
                        <button onClick={() => setWaterCount(Math.max(0, waterCount - 100))} className="p-2 border border-[#333] text-[#666] hover:text-white hover:border-[#666] flex justify-center"><Icon name="Minus" size={16}/></button>
                        <button onClick={() => setWaterCount(waterCount + 50)} className="p-2 border border-[#333] text-[#3498db] font-bold text-xs hover:bg-[#3498db]/10">+50</button>
                        <button onClick={() => setWaterCount(waterCount + 100)} className="p-2 border border-[#333] text-[#3498db] font-bold text-xs hover:bg-[#3498db]/10">+100</button>
                        <button onClick={() => setWaterCount(waterCount + 250)} className="p-2 border border-[#333] text-[#3498db] font-bold text-xs hover:bg-[#3498db]/10">+250</button>
                      </div>
                      <button onClick={handleWaterSubmit} disabled={isUploading} className="w-full py-4 bg-[#3498db] text-white font-bold text-xs tracking-widest shadow-[0_4px_20px_rgba(52,152,219,0.3)] hover:shadow-[0_4px_30px_rgba(52,152,219,0.5)] transition-all relative z-10 active:scale-95">
                        ÈÄÅÂá∫ÂñùÊ∞¥Á¥ÄÈåÑ
                      </button>
                    </div>

                    {/* Coupons */}
                    <div className="space-y-4">
                        <h3 className="text-[10px] font-bold text-[#666] uppercase tracking-[0.2em] px-2 flex items-center gap-2"><Icon name="Ticket" size={14} className="text-[#d4af37]"/> ÊàëÁöÑÂÖåÊèõÂà∏</h3>
                        <div className="flex flex-col gap-3">
                          {submissions.filter(s => s.status === 'redeemed' || s.status === 'verified').length === 0 && <p className="text-center text-[11px] text-[#444] py-6 border border-dashed border-[#333] italic">Â∞öÊú™ÊìÅÊúâÂÖåÊèõÂà∏</p>}
                          {submissions.filter(s => s.status === 'redeemed' || s.status === 'verified').map(coupon => (
                            <div key={coupon.id} className={`coupon-card p-4 flex items-center gap-4 ${coupon.status === 'verified' ? 'coupon-used' : ''}`}>
                              <div className="w-14 h-14 bg-[#121212] overflow-hidden shrink-0 border border-[#333] relative">
                                {coupon.image && <img src={coupon.image} className="w-full h-full object-cover" />}
                                {coupon.status === 'verified' && <div className="absolute inset-0 flex items-center justify-center bg-black/70 text-white font-bold text-[8px] tracking-tighter">USED</div>}
                              </div>
                              <div className="flex-1 min-w-0">
                                <p className="text-sm font-bold text-[#e5e5e5] truncate">{coupon.description.replace('üéÅ Â∑≤ÂÖåÊèõÔºö', '').replace('üçü ÊäΩÁçé‰∏≠ÁçéÔºö', '‰∏≠Áçé: ')}</p>
                                <p className="text-[10px] text-[#d4af37] font-bold mt-1 uppercase tracking-tighter">{coupon.status === 'verified' ? 'Â∑≤Ê†∏Èä∑' : 'VIP Â∞àÂ±¨Ê¨äÁõä'}</p>
                              </div>
                              <button onClick={(e) => deleteItem(e, 'submissions', coupon.id, 'ÈÄôÂºµÁ¥ÄÈåÑ')} className="text-[#444] hover:text-red-500 transition-colors p-2"><Icon name="Trash2" size={16}/></button>
                            </div>
                          ))}
                        </div>
                    </div>

                    {/* Transaction History - RESTORED */}
                    <div className="space-y-4">
                      <h3 className="text-[10px] font-bold text-[#666] uppercase tracking-[0.2em] px-2 flex items-center gap-2"><Icon name="History" size={14} className="text-[#d4af37]"/> ‰∫§ÊòìÁ¥ÄÈåÑ</h3>
                      <div className="bg-[#1e1e1e] border border-[#333] overflow-hidden">
                        {renderTransactionHistory(
                          submissions.filter(s => ['approved', 'deducted', 'redeemed', 'spent', 'won', 'verified'].includes(s.status)),
                          showAllHistoryHome,
                          () => setShowAllHistoryHome(!showAllHistoryHome)
                        )}
                      </div>
                    </div>
                </div>
            )}

            {/* Other Tabs (Rewards, Lottery, Admin) remain unchanged */}
            {activeTab === 'rewards' && (
                <div className="space-y-4 animate-in">
                    <h2 className="font-bold text-[#e5e5e5] px-2">ÂÖåÊèõÂïÜÂ∫ó</h2>
                    {rewards.map(r=><div key={r.id} className="bg-[#1e1e1e] border border-[#333] flex h-32"><div className="w-32 bg-black"><img src={r.image} className="w-full h-full object-cover opacity-80"/></div><div className="flex-1 p-4 flex flex-col justify-between"><div><h4 className="font-bold text-[#e5e5e5]">{r.name}</h4><p className="text-xs text-[#d4af37]">{r.cost} P</p></div><button onClick={()=>handleRedeem(r)} className="btn-action py-2 text-xs">ÂÖåÊèõ</button></div></div>)}
                </div>
            )}
            {activeTab === 'lottery' && (
                <div className="flex flex-col items-center justify-center h-full animate-in">
                    <div className="text-6xl mb-4 animate-float">üçü</div><button onClick={handleLottery} className="btn-action w-full py-4">ÊäΩÁçé (-5 P)</button>
                </div>
            )}
            
            {/* FULL ADMIN PANEL RESTORED */}
            {activeTab === 'admin' && isAdmin && (
                <div className="space-y-6 animate-in pb-10">
                    <h3 className="text-xs font-bold text-[#666] tracking-[0.2em] px-2">ÁÆ°ÁêÜÂæåÂè∞</h3>
                    
                    {/* 1. Pending Tasks */}
                    <div className="space-y-4">
                        <h4 className="text-[10px] font-bold text-[#d4af37] uppercase flex items-center gap-2"><Icon name="Check" size={12}/> ‰ªªÂãôÂØ©Ê†∏</h4>
                        {submissions.filter(s=>s.status==='pending').length === 0 ? <p className="text-center text-[10px] text-[#444] py-4 border border-[#333] border-dashed">ÁÑ°ÂæÖÂØ©Ê†∏È†ÖÁõÆ</p> : 
                        submissions.filter(s=>s.status==='pending').map(s=><div key={s.id} className="bg-[#1e1e1e] p-4 border border-[#333] relative"><button onClick={e=>deleteItem(e,'submissions',s.id,'Task')} className="absolute top-2 right-2 text-[#444]"><Icon name="Trash2" size={14}/></button><p className="text-sm text-[#e5e5e5] pr-6">{s.description}</p><div className="flex gap-2 mt-3 pt-3 border-t border-[#333]"><input type="number" className="bg-[#121212] p-2 text-white text-xs flex-1 outline-none focus:border-[#d4af37] border border-[#333]" placeholder="Áµ¶‰∫àÈªûÊï∏" onChange={e=>setApprovalPoints({...approvalPoints,[s.id]:e.target.value})}/><button onClick={()=>handleApprove(s,approvalPoints[s.id])} className="btn-action px-6 text-xs font-bold">ÊâπÂáÜ</button></div></div>)}
                    </div>

                    {/* 2. Manual Points */}
                    <div className="bg-[#1e1e1e] p-5 border border-[#333] shadow-lg">
                        <h4 className="text-[10px] font-bold text-[#d4af37] uppercase mb-3 flex items-center gap-2"><Icon name="Plus" size={12}/> ÊâãÂãïÁôºÊîæ/Êâ£Èô§</h4>
                        <input className="w-full bg-[#121212] p-3 text-xs text-white mb-2 border border-[#333] focus:border-[#d4af37] outline-none" placeholder="ÂéüÂõ† (‰æã: Ê¥ªÂãïÁçéÂãµ)" value={adminManualReason} onChange={e=>setAdminManualReason(e.target.value)}/>
                        <div className="flex gap-2">
                            <input className="flex-1 bg-[#121212] p-3 text-xs text-white border border-[#333] focus:border-[#d4af37] outline-none" type="number" placeholder="ÈªûÊï∏ (+/-)" value={adminManualPoints} onChange={e=>setAdminManualPoints(e.target.value)}/>
                            <button onClick={handleManualPointAdjustment} className="btn-action px-6 text-xs font-bold">Âü∑Ë°å</button>
                        </div>
                    </div>

                    {/* 3. Game Control Center (NEW + OLD) */}
                    <div className="bg-gradient-to-br from-[#1e1e1e] to-[#111] p-5 border border-[#333] shadow-lg relative overflow-hidden">
                        <h4 className="text-[10px] font-bold text-[#d4af37] uppercase mb-4 flex items-center gap-2"><Icon name="Chart" size={12}/> ÈÅäÊà≤ÂèÉÊï∏ÊéßÂà∂</h4>
                        
                        {/* Blackjack */}
                        <div className="mb-4 pb-4 border-b border-[#333]">
                            <label className="text-[10px] text-[#888] block mb-1">21Èªû Áç≤ÂãùË≥†Áéá (È†êË®≠ 1.0 = 1Ë≥†1)</label>
                            <input type="number" step="0.1" className="w-full bg-[#121212] p-2 text-xs text-white border border-[#333]" value={settings.blackjackPayout || 1.0} onChange={(e) => updateSettings({blackjackPayout: parseFloat(e.target.value)})}/>
                        </div>

                        {/* Cup Game */}
                        <div className="mb-4 pb-4 border-b border-[#333] grid grid-cols-2 gap-3">
                            <div>
                                <label className="text-[10px] text-[#888] block mb-1">ÁåúÊùØÂ≠ê ÂãùÁéá (0-1)</label>
                                <input type="number" step="0.01" max="1" min="0" className="w-full bg-[#121212] p-2 text-xs text-white border border-[#333]" value={settings.cupWinProb !== undefined ? settings.cupWinProb : 0.33} onChange={(e) => updateSettings({cupWinProb: parseFloat(e.target.value)})}/>
                            </div>
                            <div>
                                <label className="text-[10px] text-[#888] block mb-1">ÁåúÊùØÂ≠ê Ë≥†Áéá (ÂÄçÊï∏)</label>
                                <input type="number" step="0.01" className="w-full bg-[#121212] p-2 text-xs text-white border border-[#333]" value={settings.cupMultiplier || 2.97} onChange={(e) => updateSettings({cupMultiplier: parseFloat(e.target.value)})}/>
                            </div>
                        </div>

                        {/* Mines Grid (Restored) */}
                        <div className="mb-4 pb-4 border-b border-[#333]">
                            <label className="text-[10px] text-[#888] block mb-2">Mines Ê†ºÂ≠êÂ§ßÂ∞è: {settings.minesGridSize}x{settings.minesGridSize}</label>
                            <div className="flex gap-2">
                                {[3, 4, 5].map(s => <button key={s} onClick={()=>updateSettings({minesGridSize: s})} className={`flex-1 py-1 text-[10px] border ${settings.minesGridSize===s?'bg-[#d4af37] text-black border-[#d4af37]':'text-[#666] border-[#333]'}`}>{s}x{s}</button>)}
                            </div>
                        </div>

                        {/* Lottery (Restored) */}
                        <div className="mb-4">
                            <label className="text-[10px] text-[#888] block mb-1">ÊäΩÁçé‰∏≠ÁçéÊ©üÁéá: {Math.round((settings.lotteryProb || 0.1) * 100)}%</label>
                            <input type="range" min="0" max="1" step="0.01" className="w-full accent-[#d4af37]" value={settings.lotteryProb || 0.1} onChange={(e) => updateSettings({lotteryProb: parseFloat(e.target.value)})}/>
                        </div>

                        {/* Marquee (Restored) */}
                        <button onClick={() => { const t = prompt("Êñ∞ÂÖ¨ÂëäÔºö", settings.announce); if(t) updateSettings({announce: t}); }} className="w-full bg-[#333] py-2 text-[10px] text-[#ccc] border border-[#444] hover:bg-[#444]">‰øÆÊîπË∑ëÈ¶¨ÁáàÂÖ¨Âëä</button>
                    </div>

                    {/* 4. Shop Management (Restored) */}
                    <div className="bg-[#1e1e1e] p-5 border border-[#333] shadow-lg">
                        <h4 className="text-[10px] font-bold text-[#d4af37] uppercase mb-3 flex items-center gap-2"><Icon name="Store" size={12}/> ÂïÜÂ∫ó‰∏äÊû∂</h4>
                        <div className="space-y-3">
                            <input className="w-full bg-[#121212] p-3 text-xs text-white border border-[#333] focus:border-[#d4af37] outline-none" placeholder="ÂïÜÂìÅÂêçÁ®±" value={adminRewardName} onChange={e=>setAdminRewardName(e.target.value)}/>
                            <input type="number" className="w-full bg-[#121212] p-3 text-xs text-white border border-[#333] focus:border-[#d4af37] outline-none" placeholder="ÂÖåÊèõÈªûÊï∏" value={adminRewardCost} onChange={e=>setAdminRewardCost(e.target.value)}/>
                            <input type="file" className="text-[10px] text-[#666]" onChange={e=>setAdminRewardImage(e.target.files[0])}/>
                            <button onClick={handleAddRewardByAdmin} disabled={isAddingReward} className="btn-action w-full py-3 text-xs font-bold">‰∏äÊû∂ÂïÜÂìÅ</button>
                        </div>
                    </div>

                    {/* 5. Data Management (Restored) */}
                    <div className="bg-[#1e1e1e] border border-[#333] max-h-60 overflow-y-auto">
                        <div className="p-2 border-b border-[#333] bg-[#111] sticky top-0"><h4 className="text-[10px] font-bold text-[#666] uppercase">ÊâÄÊúâ‰∫§ÊòìÁ¥ÄÈåÑ (ÈªûÊìäÂûÉÂúæÊ°∂Âà™Èô§)</h4></div>
                        {submissions.map(s => (
                            <div key={s.id} className="flex justify-between items-center p-3 border-b border-[#333] text-xs hover:bg-[#222]">
                                <div className="truncate pr-2 text-[#ccc] flex-1">
                                    {s.description} <span className="text-[10px] text-[#666] ml-2">{s.userId?.substring(0,6)}</span>
                                </div>
                                <button onClick={(e) => deleteItem(e, 'submissions', s.id, s.description)} className="text-[#666] hover:text-red-500 p-2"><Icon name="Trash2" size={14}/></button>
                            </div>
                        ))}
                    </div>
                </div>
            )}
          </div>

          {/* Â∫ïÈÉ®Â∞éËà™ (Êá∏ÊµÆËÜ†ÂõäÊ®£Âºè) */}
          <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
            <div className="bg-[#1e1e1e]/90 backdrop-blur-md border border-[#333] px-6 py-3 rounded-full flex gap-6 shadow-2xl items-center">
              <button onClick={() => setActiveTab('dashboard')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'dashboard' ? 'text-[#d4af37] scale-110' : 'text-[#666] hover:text-[#888]'}`}>
                <Icon name="Home" size={20} className={activeTab === 'dashboard' ? 'stroke-[2px]' : ''}/>
              </button>
              <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'home' ? 'text-[#d4af37] scale-110' : 'text-[#666] hover:text-[#888]'}`}>
                <Icon name="Plus" size={20} className={activeTab === 'home' ? 'stroke-[2px]' : ''}/>
              </button>
              <button onClick={() => setActiveTab('games')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'games' ? 'text-[#d4af37] scale-110' : 'text-[#666] hover:text-[#888]'}`}>
                <Icon name="Cards" size={20} className={activeTab === 'games' ? 'stroke-[2px]' : ''}/>
              </button>
              <button onClick={() => setActiveTab('rewards')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'rewards' ? 'text-[#d4af37] scale-110' : 'text-[#666] hover:text-[#888]'}`}>
                <Icon name="Gift" size={20} className={activeTab === 'rewards' ? 'stroke-[2px]' : ''}/>
              </button>
              <button onClick={() => setActiveTab('lottery')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'lottery' ? 'text-[#d4af37] scale-110' : 'text-[#666] hover:text-[#888]'}`}>
                <Icon name="Dice" size={20} className={activeTab === 'lottery' ? 'stroke-[2px]' : ''}/>
              </button>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
