<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AURORA VIP</title>
  
  <!-- 1. Â≠óÈ´îÊîπÁÇ∫ Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase Config -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --bg-deep: #0f172a;
      --glass-bg: rgba(30, 41, 59, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      --accent-primary: #6366f1; /* Indigo */
      --accent-secondary: #ec4899; /* Pink */
      --text-white: #f8fafc;
      --text-gray: #94a3b8;
    }

    * { font-family: 'Montserrat', sans-serif !important; }
    
    body { 
      background-color: var(--bg-deep); 
      color: var(--text-white); 
      -webkit-tap-highlight-color: transparent; 
      font-weight: 400; 
      overflow-x: hidden;
      /* ËÉåÊôØÊ•µÂÖâÁâπÊïà */
      background-image: 
        radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 100% 100%, rgba(236, 72, 153, 0.15) 0%, transparent 50%);
      background-attachment: fixed;
    }

    /* Èö±ËóèÊç≤Ëª∏ */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    
    /* ÂãïÁï´ */
    .fade-in-up { animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .pulse-glow { animation: pulseGlow 3s infinite; }
    @keyframes pulseGlow { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

    /* ÁéªÁíÉÊì¨ÊÖãÂç°Áâá (Glassmorphism) */
    .glass-panel {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    /* Êï∏‰ΩçÊúÉÂì°Âç°Ê®£Âºè */
    .digital-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
      transform-style: preserve-3d;
      transition: transform 0.5s;
    }
    
    /* ÊåâÈàïÈáçË®≠Ë®à */
    .btn-neon {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    .btn-neon::before {
      content: '';
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
    }
    .btn-neon:active::before { opacity: 1; }
    .btn-neon:active { border-color: transparent; transform: scale(0.98); }

    /* Êº∏Â±§ÊñáÂ≠ó */
    .gradient-text {
      background: linear-gradient(to right, #a5b4fc, #f472b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    input, textarea { 
      background: rgba(0,0,0,0.3) !important; 
      border: 1px solid rgba(255,255,255,0.1) !important;
      color: white !important;
      font-weight: 300 !important;
    }
    input:focus, textarea:focus { border-color: var(--accent-primary) !important; outline: none; }

    /* Êá∏ÊµÆÂ∞éË¶ΩÂàó */
    .floating-nav {
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

  <div id="root"></div>

  <!-- Loading -->
  <div id="loading-screen" style="position:fixed; inset:0; background:#0f172a; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9999;">
    <div style="font-family:'Montserrat'; font-weight:800; font-size:2rem; letter-spacing:4px; color:white; margin-bottom:10px;" class="pulse-glow">AURORA</div>
    <div style="font-family:'Montserrat'; font-size:0.8rem; color:#64748b; letter-spacing:2px;">LOADING SYSTEM</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, increment, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCyJpNrkcVCefwq53wQDQZmZGhjOJpv27c",
      authDomain: "makinsat-36a6e.firebaseapp.com",
      projectId: "makinsat-36a6e",
      storageBucket: "makinsat-36a6e.firebasestorage.app",
      messagingSenderId: "213997948286",
      appId: "1:213997948286:web:116d44046db0f41a8e772f",
      measurementId: "G-8V2K5MLTDB"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    // ÈÄ£Á∑öËá≥ babychiu Ë≥áÊñôÂ∫´
    const db = getFirestore(app, "babychiu");
    const finalAppId = "vip-lounge-v2"; 

    window.fb = { 
      db, auth, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, 
      increment, serverTimestamp, deleteDoc, appId: finalAppId, 
      signInAnonymously, onAuthStateChanged 
    };
  </script>

  <script type="text/babel">
    const { useState, useEffect, Fragment } = React;
    const { 
      db, auth, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, 
      increment, serverTimestamp, deleteDoc, appId,
      signInAnonymously, onAuthStateChanged 
    } = window.fb;

    // --- SVG Icons (Minimalist) ---
    const Icon = ({ name, size = 20, className = "" }) => {
      const icons = {
        Home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
        Grid: <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z" />,
        Bell: <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" />,
        User: <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" />,
        Camera: <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2zM12 13a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" />,
        Plus: <path d="M12 5v14M5 12h14" />,
        Trash: <polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />,
        Check: <polyline points="20 6 9 17 4 12" />,
        Gift: <polyline points="20 12 20 22 4 22 4 12" /><rect x="2" y="7" width="20" height="5" /><line x1="12" y1="22" x2="12" y2="7" /><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" /><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" />,
        Dice: <rect x="2" y="2" width="20" height="20" rx="5" ry="5" /><path d="M16 8h.01M8 8h.01M8 16h.01M16 16h.01M12 12h.01" />
      };
      return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name]}</svg>;
    };

    const compressImage = (file) => {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 500;
            const scale = MAX_WIDTH / img.width;
            canvas.width = MAX_WIDTH;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            resolve(canvas.toDataURL('image/jpeg', 0.6));
          };
        };
      });
    };

    function App() {
      const [user, setUser] = useState(null);
      const [activeTab, setActiveTab] = useState('dashboard');
      const [isAdmin, setIsAdmin] = useState(false);
      const [points, setPoints] = useState(0);
      const [announcement, setAnnouncement] = useState('Welcome back.');
      const [submissions, setSubmissions] = useState([]);
      const [rewards, setRewards] = useState([]);
      const [notifications, setNotifications] = useState([]);
      const [loading, setLoading] = useState(true);

      // Forms
      const [desc, setDesc] = useState('');
      const [file, setFile] = useState(null);
      const [isUploading, setIsUploading] = useState(false);
      const [wishName, setWishName] = useState('');
      const [adminPass, setAdminPass] = useState('');
      const [showAdminLogin, setShowAdminLogin] = useState(false);
      
      // Admin Forms
      const [adminRewardName, setAdminRewardName] = useState('');
      const [adminRewardCost, setAdminRewardCost] = useState('');
      const [adminRewardImage, setAdminRewardImage] = useState(null);
      const [penaltyDesc, setPenaltyDesc] = useState('');
      const [penaltyAmount, setPenaltyAmount] = useState('');
      const [approvalPoints, setApprovalPoints] = useState({});

      const getPublicRef = (name) => collection(db, 'artifacts', appId, 'public', 'data', name);

      useEffect(() => {
        signInAnonymously(auth)
          .then(() => {})
          .catch((e) => {
            console.error("Auth fallback", e);
            setUser({ uid: "guest_" + Math.random().toString(36).substring(7) });
            setLoading(false);
            document.getElementById('loading-screen').style.display = 'none';
          });

        return onAuthStateChanged(auth, (u) => {
          if (u) {
            setUser(u);
            setLoading(false);
            document.getElementById('loading-screen').style.display = 'none';
          }
        });
      }, []);

      useEffect(() => {
        if (!user) return;
        const unsub1 = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), (d) => {
          if (d.exists()) setPoints(d.data().totalPoints || 0);
          else setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: 0 });
        });
        const unsub2 = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'announce'), (d) => {
          if (d.exists()) setAnnouncement(d.data().text);
        });
        const unsub3 = onSnapshot(getPublicRef('submissions'), (s) => {
          setSubmissions(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (b.timestamp?.toMillis?.() || 0) - (a.timestamp?.toMillis?.() || 0)));
        });
        const unsub4 = onSnapshot(getPublicRef('rewards'), (s) => {
          setRewards(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => a.cost - b.cost));
        });
        const unsub5 = onSnapshot(getPublicRef('notifications'), (s) => {
          setNotifications(s.docs.map(d => ({id: d.id, ...d.data()})));
        });
        return () => { unsub1(); unsub2(); unsub3(); unsub4(); unsub5(); };
      }, [user]);

      const handleSubmit = async () => {
        if (!desc.trim() || !file) return alert("Please add description and photo.");
        setIsUploading(true);
        try {
          const img = await compressImage(file);
          await addDoc(getPublicRef('submissions'), { description: desc, image: img, status: 'pending', timestamp: serverTimestamp(), userId: user.uid });
          setDesc(''); setFile(null); alert("Request sent.");
        } catch(e) { alert("Error"); } finally { setIsUploading(false); }
      };

      const handleLottery = async () => {
        if (points < 5) return alert("Insufficient points (Need 5).");
        if (!confirm("Spend 5 Points to spin?")) return;
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(-5), totalRedeemed: increment(5) });
          await addDoc(getPublicRef('submissions'), {
            description: `üçü Lottery Win: Fries`,
            image: "https://images.unsplash.com/photo-1630384060421-a4323ceca04b?q=80&w=400&auto=format&fit=crop",
            status: 'redeemed', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: -5
          });
          alert("You won Fries! Check your Coupons.");
        } catch(e) { alert("Error"); }
      };

      const handleWish = async () => {
        if (!wishName) return;
        await addDoc(getPublicRef('rewards'), { name: wishName, cost: 0, available: false, timestamp: serverTimestamp() });
        setWishName(''); alert("Wish sent.");
      };

      const handleRedeem = async (r) => {
        if (points < r.cost) return alert("Insufficient points.");
        if (!confirm(`Redeem ${r.name}?`)) return;
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(-r.cost), totalRedeemed: increment(r.cost) });
          await addDoc(getPublicRef('submissions'), { description: `üéÅ Redeemed: ${r.name}`, image: r.image, status: 'redeemed', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: -r.cost });
          alert("Redeemed successfully.");
        } catch(e) { alert("Error"); }
      };

      const checkAdmin = () => {
        if (adminPass === '520') { setIsAdmin(true); setShowAdminLogin(false); setAdminPass(''); setActiveTab('admin'); }
        else alert('Access Denied');
      };

      // Admin Actions
      const handleApprove = async (sub, pts) => {
        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'submissions', sub.id), { status: 'approved', awardedPoints: parseInt(pts)||10 });
        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(parseInt(pts)||10), totalIssued: increment(parseInt(pts)||10) });
      };
      const handleReject = async (id) => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'submissions', id));
      const handleDeduct = async () => {
        const p = parseInt(penaltyAmount);
        await addDoc(getPublicRef('submissions'), { description: `‚ö†Ô∏è Penalty: ${penaltyDesc}`, status: 'deducted', awardedPoints: -p, timestamp: serverTimestamp(), userId: user.uid });
        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: increment(-p), totalRedeemed: increment(p) });
        alert("Deducted."); setPenaltyDesc(''); setPenaltyAmount('');
      };
      const handleAddProduct = async () => {
        let img = "https://placehold.co/400x300/0f172a/6366f1?text=GIFT";
        if (adminRewardImage) img = await compressImage(adminRewardImage);
        await addDoc(getPublicRef('rewards'), { name: adminRewardName, cost: parseInt(adminRewardCost), image: img, available: true, timestamp: serverTimestamp() });
        alert("Added."); setAdminRewardName(''); setAdminRewardCost(''); setAdminRewardImage(null);
      };

      if (loading) return null;

      // Render Helpers
      const unread = notifications.filter(n => !n.readBy?.includes(user?.uid)).length;

      return (
        <div className="min-h-screen pb-32">
          
          {/* Top Bar */}
          <div className="px-6 pt-12 pb-4 flex justify-between items-end bg-gradient-to-b from-[#0f172a] to-transparent sticky top-0 z-30">
            <div>
              <p className="text-xs text-indigo-400 font-bold tracking-[0.3em] mb-1">VIP ACCESS</p>
              <h1 className="text-2xl font-bold text-white tracking-tight">Hello, Dear</h1>
            </div>
            <div className="flex gap-4">
              <button onClick={() => setActiveTab('notifications')} className="relative p-2">
                <Icon name="Bell" className="text-gray-400 hover:text-white transition-colors" />
                {unread > 0 && <span className="absolute top-1 right-1 w-2 h-2 bg-pink-500 rounded-full animate-pulse"></span>}
              </button>
              <button onClick={() => isAdmin ? setIsAdmin(false) : setShowAdminLogin(true)} className="p-2">
                <Icon name="User" className={`transition-colors ${isAdmin ? 'text-indigo-400' : 'text-gray-400'}`} />
              </button>
            </div>
          </div>

          {/* Admin Modal */}
          {showAdminLogin && !isAdmin && (
            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-6 fade-in-up">
              <div className="glass-panel p-8 rounded-3xl w-full max-w-xs text-center">
                <h3 className="text-lg font-bold mb-6 tracking-widest">SYSTEM LOCK</h3>
                <input type="password" placeholder="Passcode" className="w-full p-4 rounded-xl mb-4 text-center text-xl tracking-widest" value={adminPass} onChange={e => setAdminPass(e.target.value)} />
                <div className="flex gap-2">
                  <button onClick={() => setShowAdminLogin(false)} className="flex-1 py-3 text-xs font-bold text-gray-400">CANCEL</button>
                  <button onClick={checkAdmin} className="flex-1 py-3 bg-indigo-600 rounded-xl text-xs font-bold">UNLOCK</button>
                </div>
              </div>
            </div>
          )}

          {/* Marquee */}
          <div className="mx-6 mb-6 glass-panel rounded-lg py-2 px-4 overflow-hidden flex items-center">
            <div className="w-2 h-2 bg-green-400 rounded-full mr-3 shrink-0 animate-pulse"></div>
            <div className="marquee w-full text-xs font-medium text-gray-300 tracking-wide">
              <span>{announcement}</span>
            </div>
          </div>

          <div className="px-6 space-y-8 fade-in-up">
            
            {/* --- DASHBOARD TAB --- */}
            {activeTab === 'dashboard' && (
              <>
                {/* Digital Card */}
                <div className="digital-card rounded-3xl p-8 relative overflow-hidden aspect-[1.58/1]">
                  <div className="absolute top-0 right-0 w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
                  <div className="absolute bottom-0 left-0 w-48 h-48 bg-pink-500/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none"></div>
                  
                  <div className="relative z-10 flex flex-col justify-between h-full">
                    <div className="flex justify-between items-start">
                      <Icon name="Grid" className="text-white/50" />
                      <span className="text-[10px] border border-white/20 px-2 py-1 rounded text-white/60">TIER: DIAMOND</span>
                    </div>
                    <div>
                      <p className="text-sm text-gray-400 font-medium mb-1 tracking-widest">BALANCE</p>
                      <h2 className="text-5xl font-light text-white tracking-tighter">{points}</h2>
                    </div>
                    <div className="flex justify-between items-end">
                      <p className="text-xs text-gray-500 font-mono tracking-widest">**** 8888</p>
                      <div className="w-8 h-5 bg-white/10 rounded overflow-hidden relative">
                        <div className="absolute inset-0 bg-gradient-to-br from-yellow-200/20 to-transparent"></div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Actions */}
                <div className="grid grid-cols-2 gap-4">
                  <div className="glass-panel p-6 rounded-3xl flex flex-col justify-between h-40 relative group overflow-hidden">
                    <div className="absolute inset-0 bg-indigo-600/10 scale-0 group-hover:scale-100 transition-transform rounded-3xl"></div>
                    <Icon name="Plus" className="text-indigo-400" size={28} />
                    <div>
                      <h3 className="font-bold text-lg">Earn</h3>
                      <p className="text-[10px] text-gray-400 mt-1">Upload proof to earn points</p>
                    </div>
                    <button onClick={() => document.getElementById('earn-modal').showModal()} className="absolute inset-0"></button>
                  </div>
                  
                  <div className="glass-panel p-6 rounded-3xl flex flex-col justify-between h-40 relative group overflow-hidden">
                    <div className="absolute inset-0 bg-pink-600/10 scale-0 group-hover:scale-100 transition-transform rounded-3xl"></div>
                    <Icon name="Gift" className="text-pink-400" size={28} />
                    <div>
                      <h3 className="font-bold text-lg">Coupons</h3>
                      <p className="text-[10px] text-gray-400 mt-1">{submissions.filter(s => s.status === 'redeemed').length} Active</p>
                    </div>
                    <button onClick={() => setActiveTab('wallet')} className="absolute inset-0"></button>
                  </div>
                </div>

                {/* Transaction History Preview */}
                <div className="mt-8">
                  <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Recent Activity</h3>
                  <div className="space-y-4">
                    {submissions.filter(s => ['approved','deducted','redeemed'].includes(s.status)).slice(0,3).map(s => (
                      <div key={s.id} className="flex items-center justify-between py-2 border-b border-white/5">
                        <div className="flex items-center gap-3">
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center ${s.awardedPoints > 0 ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
                            {s.awardedPoints > 0 ? <Icon name="Plus" size={12}/> : <Icon name="Check" size={12}/>}
                          </div>
                          <div>
                            <p className="text-sm font-bold">{s.description.replace(/üéÅ |‚ö†Ô∏è |üçü /g, '').split(':')[0]}</p>
                            <p className="text-[10px] text-gray-500">{s.timestamp?.toDate().toLocaleDateString()}</p>
                          </div>
                        </div>
                        <span className={`font-mono text-sm ${s.awardedPoints > 0 ? 'text-green-400' : 'text-white'}`}>
                          {s.awardedPoints > 0 ? '+' : ''}{s.awardedPoints}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              </>
            )}

            {/* --- MARKET TAB --- */}
            {activeTab === 'market' && (
              <>
                {/* Lottery Banner */}
                <div className="relative rounded-3xl overflow-hidden p-8 text-center border border-yellow-500/20 shadow-[0_0_40px_-10px_rgba(234,179,8,0.2)]">
                  <div className="absolute inset-0 bg-gradient-to-br from-yellow-900/40 to-transparent z-0"></div>
                  <div className="relative z-10">
                    <Icon name="Dice" size={40} className="mx-auto text-yellow-400 mb-4 animate-bounce" />
                    <h2 className="text-2xl font-black text-white italic tracking-tighter mb-2">FRIES LOTTERY</h2>
                    <p className="text-xs text-yellow-200/80 mb-6">Spend 5 Points for a chance to win</p>
                    <button onClick={handleLottery} className="btn-neon px-8 py-3 rounded-full text-xs font-bold tracking-widest bg-yellow-500/10 border-yellow-500/50 hover:bg-yellow-500 text-yellow-100">
                      PLAY NOW (-5P)
                    </button>
                  </div>
                </div>

                {/* Wish Input */}
                <div className="glass-panel p-1 rounded-full flex items-center">
                  <input className="bg-transparent border-none w-full px-6 py-3 text-sm focus:ring-0 !bg-transparent !border-none" placeholder="Make a wish..." value={wishName} onChange={e => setWishName(e.target.value)} />
                  <button onClick={handleWish} className="bg-indigo-600 w-10 h-10 rounded-full flex items-center justify-center shrink-0 mr-1 hover:bg-indigo-500 transition-colors">
                    <Icon name="Plus" size={16} />
                  </button>
                </div>

                {/* Rewards Grid */}
                <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest mt-8 mb-2">Rewards Gallery</h3>
                <div className="grid grid-cols-2 gap-4">
                  {rewards.map(r => (
                    <div key={r.id} className="glass-panel rounded-2xl overflow-hidden group relative">
                      <div className="aspect-square bg-slate-800 relative">
                        <img src={r.image} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                        <div className="absolute bottom-0 left-0 bg-black/60 px-3 py-1 backdrop-blur-sm text-[10px] font-bold text-white rounded-tr-lg">
                          {r.cost} PTS
                        </div>
                        {!r.available && <div className="absolute inset-0 bg-black/80 flex items-center justify-center text-xs font-bold tracking-widest text-gray-400">SOON</div>}
                      </div>
                      <div className="p-4">
                        <h4 className="font-bold text-sm truncate mb-3">{r.name}</h4>
                        <button 
                          onClick={() => r.available && handleRedeem(r)} 
                          disabled={!r.available || points < r.cost}
                          className={`w-full py-2 rounded-lg text-[10px] font-bold border transition-colors ${r.available && points >= r.cost ? 'border-indigo-500 text-indigo-400 hover:bg-indigo-500 hover:text-white' : 'border-gray-700 text-gray-600'}`}
                        >
                          REDEEM
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </>
            )}

            {/* --- WALLET TAB (Coupons) --- */}
            {activeTab === 'wallet' && (
              <div className="space-y-4">
                <h2 className="text-2xl font-light mb-6">My <span className="font-bold text-pink-500">Rewards</span></h2>
                {submissions.filter(s => s.status === 'redeemed' || s.status === 'verified').length === 0 && (
                  <div className="text-center py-20 text-gray-600 text-xs tracking-widest">NO COUPONS YET</div>
                )}
                {submissions.filter(s => s.status === 'redeemed' || s.status === 'verified').map(c => (
                  <div key={c.id} className={`glass-panel p-4 rounded-2xl flex gap-4 ${c.status === 'verified' ? 'opacity-50 grayscale' : ''}`}>
                    <div className="w-20 h-20 bg-slate-800 rounded-xl overflow-hidden shrink-0">
                      <img src={c.image} className="w-full h-full object-cover" />
                    </div>
                    <div className="flex-1 flex flex-col justify-center min-w-0">
                      <h4 className="font-bold text-sm truncate">{c.description.replace(/üéÅ |üçü /g, '').replace('Â∑≤ÂÖåÊèõÔºö', '').replace('ÊäΩÁçé‰∏≠ÁçéÔºö', '')}</h4>
                      <p className="text-[10px] text-gray-400 mt-1 uppercase tracking-wider">{c.status === 'verified' ? 'USED' : 'VALID'}</p>
                      <p className="text-[10px] text-gray-600 mt-2 font-mono">{c.id.substring(0,8).toUpperCase()}</p>
                    </div>
                    {!isAdmin && <button onClick={() => {if(confirm('Delete?')) deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'submissions', c.id))}} className="text-gray-600"><Icon name="Trash" size={16}/></button>}
                  </div>
                ))}
              </div>
            )}

            {/* --- NOTIFICATIONS TAB --- */}
            {activeTab === 'notifications' && (
              <div className="space-y-4">
                <h2 className="text-2xl font-light mb-6">Inbox</h2>
                {notifications.map(n => (
                  <div key={n.id} className="glass-panel p-5 rounded-2xl border-l-4 border-indigo-500">
                    <h4 className="font-bold text-sm mb-1">{n.title}</h4>
                    <p className="text-xs text-gray-400 leading-relaxed">{n.body}</p>
                    <button onClick={() => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'notifications', n.id))} className="text-[10px] text-red-400 mt-3 hover:underline">Delete</button>
                  </div>
                ))}
              </div>
            )}

            {/* --- ADMIN TAB --- */}
            {activeTab === 'admin' && isAdmin && (
              <div className="space-y-8">
                <div className="bg-indigo-600 rounded-3xl p-6 shadow-2xl">
                  <h3 className="text-xs font-bold text-indigo-200 tracking-widest mb-4">ADMIN CONSOLE</h3>
                  <div className="grid grid-cols-2 gap-4 text-center">
                    <div>
                      <div className="text-2xl font-bold">{stats.totalIssued}</div>
                      <div className="text-[9px] opacity-70">ISSUED</div>
                    </div>
                    <div>
                      <div className="text-2xl font-bold">{stats.totalRedeemed}</div>
                      <div className="text-[9px] opacity-70">REDEEMED</div>
                    </div>
                  </div>
                  <button onClick={() => { const t = prompt("Announcement:"); if(t) setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'announce'), { text: t }); }} className="w-full mt-6 bg-white/10 py-2 rounded-lg text-[10px] font-bold">EDIT MARQUEE</button>
                </div>

                {/* Pending */}
                <div>
                  <h4 className="text-xs font-bold text-gray-500 mb-4 tracking-widest">PENDING APPROVALS</h4>
                  {submissions.filter(s => s.status === 'pending').map(s => (
                    <div key={s.id} className="glass-panel p-4 rounded-2xl mb-3">
                      <div className="flex gap-3 mb-3">
                        <img src={s.image} className="w-16 h-16 rounded-lg object-cover bg-slate-800" />
                        <div>
                          <p className="text-sm font-bold text-white">{s.description}</p>
                          <p className="text-[10px] text-gray-400 mt-1">{s.timestamp?.toDate().toLocaleString()}</p>
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <input className="w-16 text-center !bg-slate-800 !border-slate-700 rounded-lg text-sm" placeholder="10" value={approvalPoints[s.id]||''} onChange={e=>setApprovalPoints({...approvalPoints, [s.id]: e.target.value})} />
                        <button onClick={()=>handleApprove(s, approvalPoints[s.id])} className="flex-1 bg-indigo-600 rounded-lg text-xs font-bold">APPROVE</button>
                        <button onClick={()=>handleReject(s.id)} className="px-4 bg-slate-700 rounded-lg text-gray-300"><Icon name="Trash" size={14}/></button>
                      </div>
                    </div>
                  ))}
                </div>

                {/* Tools */}
                <div className="glass-panel p-6 rounded-3xl">
                  <h4 className="text-xs font-bold text-gray-500 mb-4 tracking-widest">TOOLS</h4>
                  <div className="space-y-4">
                    <div className="flex gap-2">
                      <input className="flex-1 !bg-slate-800 p-3 rounded-xl text-xs" placeholder="Product Name" value={adminRewardName} onChange={e=>setAdminRewardName(e.target.value)} />
                      <input className="w-20 !bg-slate-800 p-3 rounded-xl text-xs" placeholder="Cost" type="number" value={adminRewardCost} onChange={e=>setAdminRewardCost(e.target.value)} />
                    </div>
                    <input type="file" onChange={e=>setAdminRewardImage(e.target.files[0])} className="text-xs text-gray-500" />
                    <button onClick={handleAddProduct} className="w-full py-3 bg-slate-700 rounded-xl text-xs font-bold hover:bg-slate-600">ADD PRODUCT</button>
                    
                    <div className="h-px bg-white/10 my-4"></div>
                    
                    <div className="flex gap-2">
                      <input className="flex-1 !bg-red-900/20 !border-red-500/20 p-3 rounded-xl text-xs" placeholder="Penalty Reason" value={penaltyDesc} onChange={e=>setPenaltyDesc(e.target.value)} />
                      <input className="w-20 !bg-red-900/20 !border-red-500/20 p-3 rounded-xl text-xs" placeholder="Pts" type="number" value={penaltyAmount} onChange={e=>setPenaltyAmount(e.target.value)} />
                    </div>
                    <button onClick={handleDeduct} className="w-full py-3 bg-red-600/20 border border-red-500/50 text-red-400 rounded-xl text-xs font-bold">DEDUCT POINTS</button>
                  </div>
                </div>
              </div>
            )}

          </div>

          {/* Floating Navigation */}
          <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-40">
            <div className="floating-nav px-2 py-2 rounded-full flex gap-1 items-center">
              <NavButton icon="Home" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} />
              <NavButton icon="Grid" active={activeTab === 'market'} onClick={() => setActiveTab('market')} />
              <NavButton icon="Gift" active={activeTab === 'wallet'} onClick={() => setActiveTab('wallet')} />
              {isAdmin && <NavButton icon="User" active={activeTab === 'admin'} onClick={() => setActiveTab('admin')} />}
            </div>
          </div>

          {/* Earn Modal (Native Dialog) */}
          <dialog id="earn-modal" className="bg-transparent backdrop:bg-black/80 p-0 m-auto">
            <div className="glass-panel p-6 rounded-3xl w-80 text-center relative border border-gray-700">
              <h3 className="text-lg font-bold text-white mb-4">Submit Task</h3>
              <textarea className="w-full h-24 p-4 rounded-xl text-sm mb-4 resize-none" placeholder="Description..." value={desc} onChange={e => setDesc(e.target.value)}></textarea>
              <label className="block w-full py-4 border border-dashed border-gray-500 rounded-xl mb-4 cursor-pointer text-gray-400 text-xs hover:bg-white/5 transition">
                {file ? 'Photo Selected' : 'Tap to Upload Photo'}
                <input type="file" accept="image/*" className="hidden" onChange={e => setFile(e.target.files[0])} />
              </label>
              <div className="flex gap-2">
                <button onClick={() => document.getElementById('earn-modal').close()} className="flex-1 py-3 text-xs font-bold text-gray-400">CANCEL</button>
                <button onClick={() => { handleSubmit(); document.getElementById('earn-modal').close(); }} disabled={isUploading} className="flex-1 py-3 bg-indigo-600 text-white rounded-xl text-xs font-bold">SUBMIT</button>
              </div>
            </div>
          </dialog>

        </div>
      );
    }

    const NavButton = ({ icon, active, onClick }) => (
      <button onClick={onClick} className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 ${active ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30 scale-110' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
        <Icon name={icon} size={20} />
      </button>
    );

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>VIP LOUNGE</title>
  
  <!-- ÂºïÂÖ•Ë≥™ÊÑüÂúìÈ´îÂ≠ó -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase Compat (Áµ±‰∏Ä‰ΩøÁî® 10.8.1) -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>

  <style>
    /* ÂÖ®Á´ôÂ≠óÈ´îËàáÈªëÈáëÈÖçËâ≤ËÆäÊï∏ */
    :root {
      --bg-dark: #121212;
      --card-dark: #1e1e1e;
      --text-main: #e5e5e5;
      --text-muted: #a3a3a3;
      --gold-main: #d4af37;
      --gold-light: #f1c40f;
    }

    * { font-family: 'Noto Sans TC', sans-serif !important; }
    
    body { 
      background-color: var(--bg-dark); 
      color: var(--text-main); 
      -webkit-tap-highlight-color: transparent; 
      font-weight: 300; 
      overflow-x: hidden; 
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    #root { opacity: 0; transition: opacity 0.5s ease-in; }
    #root.loaded { opacity: 1; }
    
    @keyframes floating { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    .animate-float { animation: floating 4s ease-in-out infinite; }
    
    img { display: block; max-width: 100%; height: auto; border-radius: 0px; } /* ÂúñÁâá‰πüÊîπÁÇ∫Áõ¥Ëßí */
    
    /* ÈªëÈáëÊº∏Â±§ËÉåÊôØ - ÁßªÈô§ÂúìËßí */
    .vip-gradient { background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); border-bottom: 1px solid #333; }
    .gold-text-gradient { background: linear-gradient(to right, #d4af37, #f1c40f); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    /* ÁßªÈô§ÂúìËßíË®≠ÂÆö */
    .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 215, 0, 0.1); border-radius: 0; }
    
    /* ÂÖåÊèõÂà∏Ê®£Âºè - ÊñπÂΩ¢Âåñ */
    .coupon-card {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 0; /* Áõ¥Ëßí */
      position: relative;
      overflow: hidden;
      transition: all 0.4s ease;
    }
    /* Ë£ùÈ£æÁî®ÁöÑÂ∞èÁº∫Âè£ÊîπÁÇ∫ÊñπÂΩ¢ÊàñÁßªÈô§ÔºåÈÄôË£°ÊîπÁÇ∫ÊñπÂΩ¢Áº∫Âè£‰ª•Á¨¶ÂêàÈ¢®Ê†º */
    .coupon-card::before, .coupon-card::after {
      content: '';
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--bg-dark);
      border-radius: 0; /* Áõ¥ËßíÁº∫Âè£ */
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      border: 1px solid #333;
    }
    .coupon-card::before { left: -6px; border-right: none; }
    .coupon-card::after { right: -6px; border-left: none; }

    .coupon-used { filter: grayscale(1); opacity: 0.5; border-color: #444; }

    /* ÈáëËâ≤ÊåâÈàïÊ®£Âºè - ÊñπÂΩ¢ */
    .btn-action {
      background: linear-gradient(135deg, #d4af37, #c5a028);
      color: #000;
      transition: all 0.3s ease;
      font-weight: 700;
      border-radius: 0; /* Áõ¥Ëßí */
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.1);
    }
    .btn-action:active { transform: scale(0.98); box-shadow: none; }
    .btn-action:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

    .log-item { border-bottom: 1px solid #333; }
    .log-item:last-child { border-bottom: none; }
    
    /* Ë∑ëÈ¶¨Ááà */
    .marquee { white-space: nowrap; overflow: hidden; box-sizing: border-box; }
    .marquee span { display: inline-block; padding-left: 100%; animation: marquee 15s linear infinite; }
    @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
    
    input, textarea { font-weight: 300 !important; color: white !important; border-radius: 0 !important; }
    button { font-weight: 500 !important; border-radius: 0 !important; }
    
    /* Ëá™ÂÆöÁæ©ÊñπÂΩ¢ checkbox/radio */
    input[type="checkbox"], input[type="radio"] { accent-color: #d4af37; }
  </style>
</head>
<body>

  <div id="root"></div>

  <!-- ËºâÂÖ•‰∏≠ÂãïÁï´ -->
  <div id="loading-screen" style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; color:#d4af37; font-weight:300; z-index:100;">
    <div class="animate-float" style="font-size: 40px; margin-bottom: 10px;">üëë</div>
    <div style="letter-spacing: 2px; font-size: 13px; color: #888;">Ê≠£Âú®ÈÄ≤ÂÖ• VIP LOUNGE...</div>
  </div>

  <script type="module">
    // Áµ±‰∏Ä‰ΩøÁî® 10.8.1 ÁâàÊú¨
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, increment, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCyJpNrkcVCefwq53wQDQZmZGhjOJpv27c",
      authDomain: "makinsat-36a6e.firebaseapp.com",
      projectId: "makinsat-36a6e",
      storageBucket: "makinsat-36a6e.firebasestorage.app",
      messagingSenderId: "213997948286",
      appId: "1:213997948286:web:116d44046db0f41a8e772f",
      measurementId: "G-8V2K5MLTDB"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    // üö® ÊåáÂÆöË≥áÊñôÂ∫´ÂêçÁ®± "babychiu"
    const db = getFirestore(app, "babychiu");
    const finalAppId = "vip-lounge-v2"; 

    window.fb = { 
      db, auth, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, 
      increment, serverTimestamp, deleteDoc, appId: finalAppId, 
      signInAnonymously, onAuthStateChanged 
    };
  </script>

  <script type="text/babel">
    const { useState, useEffect, Fragment } = React;
    const { 
      db, auth, doc, setDoc, updateDoc, collection, onSnapshot, addDoc, 
      increment, serverTimestamp, deleteDoc, appId,
      signInAnonymously, onAuthStateChanged 
    } = window.fb;

    // --- ÂúñÁ§∫ÂÖÉ‰ª∂ (SVG) ---
    const Icon = ({ name, size = 24, className = "" }) => {
      const icons = {
        Point: <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />, // Diamond shape
        Camera: (<Fragment><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Fragment>),
        Gift: (<Fragment><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></Fragment>),
        Bell: (<Fragment><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></Fragment>),
        Lock: (<Fragment><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Fragment>),
        LogOut: (<Fragment><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></Fragment>),
        Trash2: (<Fragment><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Fragment>),
        Ticket: (<Fragment><path d="M2 9V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 0 0 4v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 0 0-4Z"/><path d="M13 3v18M9 3v18M15 3v18"/></Fragment>),
        Store: (<Fragment><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/></Fragment>),
        Chart: (<Fragment><path d="M12 20V10M18 20V4M6 20v-4"/></Fragment>),
        Check: <polyline points="20 6 9 17 4 12"/>,
        Alert: (<Fragment><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></Fragment>),
        History: (<Fragment><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></Fragment>),
        Sparkles: (<Fragment><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4M9 3v4M3 5h4M3 9h4"/></Fragment>),
        Image: (<Fragment><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></Fragment>),
        Plus: (<Fragment><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Fragment>),
        Dice: (<Fragment><rect x="3" y="3" width="18" height="18" rx="0" ry="0"/><circle cx="8.5" cy="8.5" r="1.5"/><circle cx="15.5" cy="15.5" r="1.5"/><circle cx="15.5" cy="8.5" r="1.5"/><circle cx="8.5" cy="15.5" r="1.5"/><circle cx="12" cy="12" r="1.5"/></Fragment>)
      };
      return (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
          {icons[name] || null}
        </svg>
      );
    };

    const compressImage = (file) => {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (e) => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 400; 
            const scale = MAX_WIDTH / img.width;
            canvas.width = MAX_WIDTH;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            resolve(canvas.toDataURL('image/jpeg', 0.5)); 
          };
        };
      });
    };

    function App() {
      const [user, setUser] = useState(null);
      const [activeTab, setActiveTab] = useState('home');
      const [isAdmin, setIsAdmin] = useState(false);
      const [points, setPoints] = useState(0);
      const [stats, setStats] = useState({ totalIssued: 0, totalRedeemed: 0 });
      const [submissions, setSubmissions] = useState([]);
      const [rewards, setRewards] = useState([]);
      const [notifications, setNotifications] = useState([]);
      const [announcement, setAnnouncement] = useState('Welcome to VIP Lounge üñ§');
      const [loading, setLoading] = useState(true);

      const [desc, setDesc] = useState('');
      const [selectedFile, setSelectedFile] = useState(null);
      const [isUploading, setIsUploading] = useState(false);
      const [isProcessing, setIsProcessing] = useState(false);
      const [adminPass, setAdminPass] = useState('');
      const [showAdminLogin, setShowAdminLogin] = useState(false);

      const [wishName, setWishName] = useState('');
      const [wishImage, setWishImage] = useState(null);
      const [showWishForm, setShowWishForm] = useState(false);
      const [isWishing, setIsWishing] = useState(false);

      const [adminRewardName, setAdminRewardName] = useState('');
      const [adminRewardCost, setAdminRewardCost] = useState('');
      const [adminRewardImage, setAdminRewardImage] = useState(null);
      const [isAddingReward, setIsAddingReward] = useState(false);
      const [approvalPoints, setApprovalPoints] = useState({});
      const [penaltyDesc, setPenaltyDesc] = useState('');
      const [penaltyAmount, setPenaltyAmount] = useState('');

      const getPublicRef = (name) => collection(db, 'artifacts', appId, 'public', 'data', name);

      useEffect(() => {
        signInAnonymously(auth)
          .then(() => {})
          .catch((error) => {
            console.error("Auth Error (Fallback to Guest):", error);
            const guestUser = { uid: "guest_" + Math.random().toString(36).substring(7) };
            setUser(guestUser);
            setLoading(false);
            const ls = document.getElementById('loading-screen');
            if (ls) ls.style.display = 'none';
            const rt = document.getElementById('root');
            if (rt) rt.classList.add('loaded');
          });

        return onAuthStateChanged(auth, (u) => {
          if (u) {
            setUser(u);
            setLoading(false);
            const ls = document.getElementById('loading-screen');
            if (ls) ls.style.display = 'none';
            const rt = document.getElementById('root');
            if (rt) rt.classList.add('loaded');
          }
        });
      }, []);

      useEffect(() => {
        if (!user) return;
        const unsubStats = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), (d) => {
          if (d.exists()) {
            setPoints(d.data().totalPoints || 0);
            setStats({ totalIssued: d.data().totalIssued || 0, totalRedeemed: d.data().totalRedeemed || 0 });
          } else {
            setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { totalPoints: 0, totalIssued: 0, totalRedeemed: 0 });
          }
        });
        
        const unsubAnnounce = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'announce'), (d) => {
          if (d.exists()) setAnnouncement(d.data().text);
        });

        const unsubSubs = onSnapshot(getPublicRef('submissions'), (s) => {
          const data = s.docs.map(d => ({id: d.id, ...d.data()}));
          data.sort((a, b) => (b.timestamp?.toMillis ? b.timestamp.toMillis() : Date.now()) - (a.timestamp?.toMillis ? a.timestamp.toMillis() : Date.now()));
          setSubmissions(data);
        });

        const unsubRewards = onSnapshot(getPublicRef('rewards'), (s) => {
          const data = s.docs.map(d => ({id: d.id, ...d.data()}));
          data.sort((a, b) => (a.available === b.available) ? (a.cost - b.cost) : (a.available ? -1 : 1));
          setRewards(data);
        });

        const unsubNotifs = onSnapshot(getPublicRef('notifications'), (s) => {
          const data = s.docs.map(d => ({id: d.id, ...d.data()}));
          data.sort((a, b) => (b.timestamp?.toMillis ? b.timestamp.toMillis() : Date.now()) - (a.timestamp?.toMillis ? a.timestamp.toMillis() : Date.now()));
          setNotifications(data);
        });
        return () => { unsubStats(); unsubSubs(); unsubRewards(); unsubNotifs(); unsubAnnounce(); };
      }, [user]);

      const deleteItem = async (colName, id, itemName) => {
        if (!confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${itemName}„ÄçÂóéÔºü`)) return;
        try { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', colName, id)); } catch (e) { alert("Âà™Èô§Â§±Êïó"); }
      };

      const checkAdmin = () => {
        const secret = [53, 50, 48]; 
        const inputCodes = Array.from(adminPass).map(c => c.charCodeAt(0));
        if (JSON.stringify(secret) === JSON.stringify(inputCodes)) {
          setIsAdmin(true); setShowAdminLogin(false); setAdminPass(''); setActiveTab('admin');
        } else { alert('ÂØÜÁ¢ºÈåØË™§ üîí'); }
      };

      const handleUploadTask = async () => {
        if (!desc.trim() || !selectedFile) return alert("Ë´ãËº∏ÂÖ•Ë™™Êòé‰∏¶‰∏äÂÇ≥ÁÖßÁâá ‚òÅÔ∏è");
        setIsUploading(true);
        try {
          const imgBase64 = await compressImage(selectedFile);
          await addDoc(getPublicRef('submissions'), {
            description: desc, image: imgBase64, status: 'pending', timestamp: serverTimestamp(), userId: user.uid
          });
          setDesc(''); setSelectedFile(null); alert("Êèê‰∫§ÊàêÂäüÔºÅÁ≠âÂæÖÂ∫óÈï∑ÂØ©Ê†∏");
        } catch(e){ alert("Â§±Êïó"); } finally { setIsUploading(false); }
      };

      const handleApprove = async (sub, customPoints) => {
        setIsProcessing(true);
        const pts = parseInt(customPoints) || 10;
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'submissions', sub.id), { status: 'approved', awardedPoints: pts });
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
            totalPoints: increment(pts),
            totalIssued: increment(pts)
          });
          alert(`ÊâπÂáÜÊàêÂäüÔºÅÂ∑≤ÁôºÊîæ ${pts} Èªû`);
        } catch(e) { alert("Â§±Êïó"); } finally { setIsProcessing(false); }
      };

      const handleDeductPoints = async () => {
        if (!penaltyDesc.trim() || !penaltyAmount) return alert("Ë´ãËº∏ÂÖ•ÂéüÂõ†ËàáÂàÜÊï∏");
        const pts = parseInt(penaltyAmount);
        setIsProcessing(true);
        try {
          await addDoc(getPublicRef('submissions'), {
            description: `‚ö†Ô∏è Êâ£ÈªûÔºö${penaltyDesc}`, status: 'deducted', awardedPoints: -pts, timestamp: serverTimestamp(), userId: user.uid
          });
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
            totalPoints: increment(-pts),
            totalRedeemed: increment(pts) 
          });
          setPenaltyDesc(''); setPenaltyAmount(''); alert(`Â∑≤Êâ£Èô§ ${pts} ÈªûÔºÅ`);
        } catch (e) { alert("Â§±Êïó"); } finally { setIsProcessing(false); }
      };

      const handleLottery = async () => {
        const cost = 5;
        if (points < cost) return alert("ÈªûÊï∏‰∏çË∂≥ÔºÅÈúÄË¶Å 5 ÈªûÊâçËÉΩÊäΩËñØÊ¢ù üçü");
        if (!confirm(`Á¢∫ÂÆöËä±Ë≤ª ${cost} ÈªûÊäΩËñØÊ¢ùÂóéÔºü`)) return;

        try {
          // 1. Êâ£Èªû
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
            totalPoints: increment(-cost),
            totalRedeemed: increment(cost)
          });
          // 2. ÁôºÊîæËñØÊ¢ùÂà∏
          await addDoc(getPublicRef('submissions'), {
            description: `üçü ÊäΩÁçé‰∏≠ÁçéÔºöÁèæÁÇ∏ËñØÊ¢ù‰∏Ä‰ªΩ`, 
            // ÈÄôË£°Êîæ‰∏ÄÂºµËñØÊ¢ùÁöÑÂúñ
            image: "https://images.unsplash.com/photo-1630384060421-a4323ceca04b?q=80&w=400&auto=format&fit=crop", 
            status: 'redeemed', 
            timestamp: serverTimestamp(), 
            userId: user.uid, 
            awardedPoints: -cost
          });
          alert("üéâ ÊÅ≠ÂñúÔºÅÁç≤ÂæóËñØÊ¢ù‰∏Ä‰ªΩÔºÅË´ãËá≥„ÄåÂÖåÊèõÂà∏„ÄçÊü•Áúã");
        } catch(e) {
          alert("ÊäΩÁçéÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶");
          console.error(e);
        }
      };

      const handleMakeWish = async () => {
        if (!wishName.trim()) return alert("Ë´ãËº∏ÂÖ•Á¶ÆÁâ©ÂêçÁ®±");
        setIsWishing(true);
        try {
          let img = "https://placehold.co/400x300/1e1e1e/d4af37?text=WISH";
          if (wishImage) img = await compressImage(wishImage);
          await addDoc(getPublicRef('rewards'), {
            name: wishName, image: img, cost: 0, available: false, timestamp: serverTimestamp(), userId: user.uid
          });
          setShowWishForm(false); setWishName(''); setWishImage(null); alert("Ë®±È°òÊàêÂäüÔºÅÂ∫óÈï∑ÊúÉÁõ°Âø´ËôïÁêÜ ‚ú®");
        } catch(e) { alert("Â§±Êïó"); } finally { setIsWishing(false); }
      };

      const handleVerifyCoupon = async (couponId) => {
        if (!confirm('Á¢∫Ë™çÊ†∏Èä∑ÈÄôÂºµÂà∏ÂóéÔºü')) return;
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'submissions', couponId), { status: 'verified' });
          alert("Ê†∏Èä∑ÊàêÂäüÔºÅ‚ú®");
        } catch (e) { alert("Â§±Êïó"); }
      };

      const handleAddRewardByAdmin = async () => {
        if (!adminRewardName || !adminRewardCost) return alert("Ë≥áË®ä‰∏çÂÖ®");
        setIsAddingReward(true);
        try {
          let img = "https://placehold.co/400x300/1e1e1e/d4af37?text=GIFT";
          if (adminRewardImage) img = await compressImage(adminRewardImage);
          await addDoc(getPublicRef('rewards'), {
            name: adminRewardName, image: img, cost: parseInt(adminRewardCost), available: true, timestamp: serverTimestamp()
          });
          setAdminRewardName(''); setAdminRewardCost(''); setAdminRewardImage(null); alert("ÂïÜÂìÅ‰∏äÊû∂ÊàêÂäüÔºÅüõí");
        } catch(e) { alert("Â§±Êïó"); } finally { setIsAddingReward(false); }
      };

      const handleRedeem = async (reward) => {
        if (points < Number(reward.cost)) return alert("ÈªûÊï∏‰∏çË∂≥ üíé");
        if (!confirm(`Á¢∫ÂÆöÂÖåÊèõ„Äå${reward.name}„ÄçÔºü`)) return;
        try {
          await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'stats', 'total'), { 
            totalPoints: increment(-reward.cost),
            totalRedeemed: increment(reward.cost)
          });
          await addDoc(getPublicRef('submissions'), {
            description: `üéÅ Â∑≤ÂÖåÊèõÔºö${reward.name}`, image: reward.image, status: 'redeemed', timestamp: serverTimestamp(), userId: user.uid, awardedPoints: -reward.cost
          });
          alert("ÂÖåÊèõÊàêÂäüÔºÅüéâ");
        } catch (e) { alert("Â§±Êïó"); }
      };

      const updateAnnounce = async () => {
        const newText = prompt("Ë´ãËº∏ÂÖ•Êñ∞ÂÖ¨ÂëäÔºö", announcement);
        if (newText) await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'announce'), { text: newText });
      };

      const unreadCountReal = user ? notifications.filter(n => !n.readBy?.includes(user.uid)).length : 0;

      if (loading) return null;

      return (
        <div className="max-w-md mx-auto shadow-2xl relative min-h-screen pb-24 sm:my-4 sm:border-2 sm:border-[#333] bg-[#121212] overflow-hidden flex flex-col no-scrollbar">
          
          {/* Header */}
          <div className="vip-gradient p-5 pb-7 text-white shadow-lg shrink-0 z-10 relative">
            <div className="flex justify-between items-center mb-5">
              <div className="flex items-center gap-2 border-l-4 border-[#d4af37] pl-3">
                <Icon name="Point" size={18} className="text-[#d4af37]" />
                <h1 className="text-xl font-bold tracking-widest uppercase italic gold-text-gradient">VIP CLUB</h1>
              </div>
              <div className="flex items-center gap-2">
                <button onClick={() => setActiveTab('notifs')} className="relative p-2 bg-white/5 transition-all hover:bg-white/10 rounded-none">
                  <Icon name="Bell" size={18} className="text-[#a3a3a3]" />
                  {unreadCountReal > 0 && <span className="absolute -top-1 -right-1 bg-red-600 text-white text-[8px] font-black w-4 h-4 flex items-center justify-center border border-[#121212] rounded-none">!</span>}
                </button>
                <button onClick={() => isAdmin ? setIsAdmin(false) : setShowAdminLogin(!showAdminLogin)} className="p-2 bg-white/5 hover:bg-white/10 rounded-none">
                  <Icon name={isAdmin ? "LogOut" : "Lock"} size={18} className="text-[#a3a3a3]" />
                </button>
              </div>
            </div>
            <div className="flex justify-center mb-6">
              <div className="glass-card px-8 py-3 flex items-center gap-4 shadow-[0_0_20px_rgba(212,175,55,0.2)]">
                <span className="text-4xl font-bold tracking-tight text-[#d4af37] drop-shadow-md">{points}</span>
                <span className="text-[10px] font-bold text-[#888] uppercase tracking-[0.2em] border-l border-[#333] pl-4">Current<br/>Points</span>
              </div>
            </div>
            <div className="bg-[#1e1e1e] px-3 py-1.5 marquee mx-2 border border-[#333]">
              <span className="text-[11px] font-medium text-[#d4af37] tracking-wider">{announcement}</span>
            </div>
            {showAdminLogin && !isAdmin && (
              <div className="absolute top-20 right-6 bg-[#1e1e1e] p-6 shadow-2xl z-50 w-64 border border-[#333] animate-in">
                <p className="text-[10px] font-bold mb-4 text-[#888] uppercase tracking-widest flex items-center gap-2">Security Access</p>
                <input type="password" placeholder="Passcode" className="w-full bg-[#121212] border border-[#333] p-3 mb-4 text-sm text-white focus:border-[#d4af37] outline-none" value={adminPass} onChange={(e) => setAdminPass(e.target.value)} />
                <button onClick={checkAdmin} className="w-full btn-action py-3 text-xs shadow-lg">UNLOCK</button>
              </div>
            )}
          </div>

          <div className="p-5 flex-1 overflow-y-auto no-scrollbar">
            
            {/* 1. ÈõÜÈªûÂàÜÈ†Å (Â∑≤ÁßªÈô§ÂãïÊÖãÁâÜ) */}
            {activeTab === 'home' && (
              <div className="space-y-6 animate-in">
                <div className="bg-[#1e1e1e] p-6 border border-[#333] shadow-lg">
                  <h3 className="font-bold text-[#e5e5e5] mb-5 flex gap-2 items-center tracking-wide"><Icon name="Plus" size={18} className="text-[#d4af37]"/> Áî≥Ë´ãÈªûÊï∏</h3>
                  <textarea className="w-full bg-[#121212] p-4 border border-[#333] text-sm min-h-[90px] outline-none focus:border-[#d4af37] transition-all text-[#e5e5e5]" placeholder="‰ªäÂ§©ÂÆåÊàê‰∫Ü‰ªÄÈ∫º‰ªªÂãô..." value={desc} onChange={(e) => setDesc(e.target.value)} />
                  <div className="flex gap-3 mt-5">
                    <label className={`flex-[1.5] cursor-pointer py-3.5 flex items-center justify-center border transition-all ${selectedFile ? 'border-[#d4af37] bg-[#d4af37]/10 text-[#d4af37]' : 'border-[#333] bg-[#121212] text-[#666] hover:border-[#555]'}`}>
                      <Icon name="Image" size={16} className="mr-2"/> <span className="text-xs font-bold">{selectedFile ? 'Â∑≤ÈÅ∏Êìá' : '‰∏äÂÇ≥Ë≠âÊòé'}</span>
                      <input type="file" accept="image/*" className="hidden" onChange={(e) => setSelectedFile(e.target.files[0])} />
                    </label>
                    <button onClick={handleUploadTask} disabled={isUploading} className="flex-1 btn-action py-3.5 text-xs">Êèê‰∫§Áî≥Ë´ã</button>
                  </div>
                </div>

                <div className="space-y-4">
                   <h3 className="text-[10px] font-bold text-[#666] uppercase tracking-[0.2em] px-2 flex items-center gap-2"><Icon name="Ticket" size={14} className="text-[#d4af37]"/> ÊàëÁöÑÂÖåÊèõÂà∏</h3>
                   <div className="flex flex-col gap-3">
                     {submissions.filter(s => s.status === 'redeemed' || s.status === 'verified').length === 0 && <p className="text-center text-[11px] text-[#444] py-6 border border-dashed border-[#333] italic">Â∞öÊú™ÊìÅÊúâÂÖåÊèõÂà∏</p>}
                     {submissions.filter(s => s.status === 'redeemed' || s.status === 'verified').map(coupon => (
                       <div key={coupon.id} className={`coupon-card p-4 flex items-center gap-4 ${coupon.status === 'verified' ? 'coupon-used' : ''}`}>
                         <div className="w-14 h-14 bg-[#121212] overflow-hidden shrink-0 border border-[#333] relative">
                           {coupon.image && <img src={coupon.image} className="w-full h-full object-cover" />}
                           {coupon.status === 'verified' && <div className="absolute inset-0 flex items-center justify-center bg-black/70 text-white font-bold text-[8px] tracking-tighter">USED</div>}
                         </div>
                         <div className="flex-1 min-w-0">
                           <p className="text-sm font-bold text-[#e5e5e5] truncate">{coupon.description.replace('üéÅ Â∑≤ÂÖåÊèõÔºö', '').replace('üçü ÊäΩÁçé‰∏≠ÁçéÔºö', '‰∏≠Áçé: ')}</p>
                           <p className="text-[10px] text-[#d4af37] font-bold mt-1 uppercase tracking-tighter">{coupon.status === 'verified' ? 'Â∑≤Ê†∏Èä∑' : 'VIP Â∞àÂ±¨Ê¨äÁõä'}</p>
                         </div>
                         <button onClick={() => deleteItem('submissions', coupon.id, 'ÈÄôÂºµÁ¥ÄÈåÑ')} className="text-[#444] hover:text-red-500 transition-colors p-2"><Icon name="Trash2" size={16}/></button>
                       </div>
                     ))}
                   </div>
                </div>

                <div className="space-y-4">
                  <h3 className="text-[10px] font-bold text-[#666] uppercase tracking-[0.2em] px-2 flex items-center gap-2"><Icon name="History" size={14} className="text-[#d4af37]"/> ‰∫§ÊòìÁ¥ÄÈåÑ</h3>
                  <div className="bg-[#1e1e1e] border border-[#333] overflow-hidden">
                    {submissions.filter(s => s.status === 'approved' || s.status === 'deducted' || s.status === 'redeemed').length === 0 ? (
                      <p className="text-center text-[11px] text-[#444] py-8 italic">Â∞öÁÑ°‰∫§ÊòìÁ¥ÄÈåÑ</p>
                    ) : (
                      <div className="flex flex-col">
                        {submissions.filter(s => s.status === 'approved' || s.status === 'deducted' || s.status === 'redeemed').map(item => (
                          <div key={item.id} className="log-item p-4 flex justify-between items-center">
                            <div className="flex flex-col min-w-0">
                              <span className="text-[9px] text-[#666] font-bold uppercase">{item.timestamp ? new Date(item.timestamp.seconds * 1000).toLocaleDateString() : 'Just now'}</span>
                              <p className="text-xs font-medium text-[#ccc] truncate pr-2">{item.description.replace('üéÅ Â∑≤ÂÖåÊèõÔºö', 'ÂÖåÊèõ: ').replace('‚ö†Ô∏è Êâ£ÈªûÔºö', 'Êâ£Èªû: ').replace('üçü ÊäΩÁçé‰∏≠ÁçéÔºö', 'ÊäΩÁçé: ')}</p>
                            </div>
                            <div className={`text-sm font-bold shrink-0 ${item.awardedPoints > 0 ? 'text-[#2ed573]' : 'text-[#ff4757]'}`}>
                              {item.awardedPoints > 0 ? `+${item.awardedPoints}` : item.awardedPoints}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* 2. ÂÖåÊèõÂàÜÈ†Å */}
            {activeTab === 'rewards' && (
              <div className="space-y-6 animate-in">
                {/* Ë®±È°òÂçÄ */}
                <div className="bg-[#1e1e1e] p-6 border border-[#333] relative overflow-hidden group shadow-lg">
                  <Icon name="Sparkles" className="absolute top-2 right-2 text-[#d4af37] opacity-20 group-hover:rotate-12 transition-transform" size={80} />
                  <h2 className="font-bold text-lg mb-1 flex items-center gap-2 text-[#e5e5e5]">Ë®±È°òÊ±† ‚ú®</h2>
                  <p className="text-xs text-[#888] mb-5 font-medium">ÊÉ≥Ë¶Å‰ªÄÈ∫ºÊñ∞ÁçéÂìÅÔºüÁõ¥Êé•Ë®±È°òÔºÅ</p>
                  
                  {!showWishForm ? (
                    <button 
                      onClick={() => setShowWishForm(true)} 
                      className="btn-action px-6 py-3 text-xs w-full sm:w-auto"
                    >
                      ÈñãÂßãË®±È°ò +
                    </button>
                  ) : (
                    <div className="space-y-4 animate-in">
                      <input 
                        className="w-full bg-[#121212] border border-[#333] p-4 text-[#e5e5e5] text-sm placeholder:text-[#555] focus:border-[#d4af37] outline-none" 
                        placeholder="Ë´ãËº∏ÂÖ•È°òÊúõÂêçÁ®±..." 
                        value={wishName} 
                        onChange={(e) => setWishName(e.target.value)} 
                      />
                      <label className="flex items-center justify-center py-5 bg-[#121212] border border-[#333] border-dashed cursor-pointer hover:bg-[#1a1a1a] transition-all">
                        <Icon name="Camera" size={20} className="mr-2 text-[#555]"/>
                        <span className="text-xs font-bold text-[#555]">{wishImage ? 'ÁÖßÁâáÂ∑≤ÈÅ∏' : 'ÂèÉËÄÉÂúñÁâá'}</span>
                        <input type="file" accept="image/*" className="hidden" onChange={(e) => setWishImage(e.target.files[0])} />
                      </label>
                      <div className="flex gap-2">
                        <button onClick={() => setShowWishForm(false)} className="flex-1 text-xs font-bold py-3.5 bg-[#121212] text-[#666] border border-[#333]">ÂèñÊ∂à</button>
                        <button onClick={handleMakeWish} disabled={isWishing} className="flex-1 text-xs font-bold py-3.5 btn-action shadow-lg disabled:opacity-50">
                          {isWishing ? 'ÂÇ≥ÈÄÅ‰∏≠...' : 'ÈÄÅÂá∫'}
                        </button>
                      </div>
                    </div>
                  )}
                </div>

                <div className="space-y-4">
                  <h2 className="font-bold text-[#e5e5e5] text-lg flex gap-2 items-center px-1 mb-2"><Icon name="Store" className="text-[#d4af37]" size={20}/> Â∞äÊ¶ÆÂÖåÊèõ</h2>
                  {rewards.map(r => (
                    <div key={r.id} className="bg-[#1e1e1e] border border-[#333] shadow-lg flex h-36 group overflow-hidden relative">
                      {isAdmin && (
                        <button onClick={() => deleteItem('rewards', r.id, r.name)} className="absolute top-2 right-2 z-20 bg-black/50 backdrop-blur-md p-2 text-[#ccc] hover:text-red-500 transition-all">
                          <Icon name="Trash2" size={14}/>
                        </button>
                      )}
                      <div className="w-2/5 bg-[#121212] relative shrink-0 overflow-hidden m-0">
                        {r.image && <img src={r.image} className={`w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110 opacity-80`} />}
                        {!r.available && <div className="absolute inset-0 flex items-center justify-center bg-black/80 text-[#d4af37] text-[10px] font-bold tracking-widest">Ë£úË≤®‰∏≠</div>}
                      </div>
                      <div className="flex-1 p-5 pl-4 flex flex-col justify-between min-w-0">
                        <div>
                          <h4 className="text-sm font-bold text-[#e5e5e5] truncate pr-6 leading-tight">{r.name}</h4>
                          {r.available && <p className="text-[10px] text-[#d4af37] font-bold mt-1 uppercase tracking-widest">{r.cost} P</p>}
                        </div>
                        <button onClick={() => r.available && handleRedeem(r)} disabled={!r.available || points < Number(r.cost)} className={`w-full py-2.5 text-[10px] font-bold transition-all ${r.available && points >= Number(r.cost) ? 'btn-action' : 'bg-[#333] text-[#666]'}`}>
                          {r.available ? (points >= Number(r.cost) ? 'Á´ãÂç≥ÂÖåÊèõ' : 'ÈªûÊï∏‰∏çË∂≥') : 'Á≠âÂÄôÂÆöÂÉπ'}
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Êñ∞Â¢ûÔºöÊäΩÁçéÂàÜÈ†Å */}
            {activeTab === 'lottery' && (
              <div className="space-y-6 animate-in flex flex-col items-center justify-center h-full pb-10">
                <div className="w-full bg-[#1e1e1e] p-8 border border-[#333] shadow-lg text-center space-y-6">
                  <div className="text-6xl animate-float">üçü</div>
                  <div>
                    <h2 className="text-2xl font-bold text-[#d4af37] uppercase tracking-widest mb-2">LUCKY DRAW</h2>
                    <p className="text-[#888] text-xs">Ëä±Ë≤ª 5 ÈªûÔºåË©¶Ë©¶ÊâãÊ∞£ÊäΩËñØÊ¢ù</p>
                  </div>
                  <div className="w-full border-t border-[#333] my-4"></div>
                  <button onClick={handleLottery} className="w-full btn-action py-5 text-sm tracking-[0.2em] shadow-[0_0_30px_rgba(212,175,55,0.2)] hover:shadow-[0_0_50px_rgba(212,175,55,0.4)] transition-all">
                    Á´ãÂç≥ÊäΩÁçé (-5 P)
                  </button>
                </div>
                <p className="text-[10px] text-[#444] mt-4">‰∏≠ÁçéÂæåË´ãËá≥È¶ñÈ†Å„ÄåÂÖåÊèõÂà∏„ÄçÊü•Áúã</p>
              </div>
            )}

            {/* 3. ÈÄöÁü•ÂàÜÈ†Å */}
            {activeTab === 'notifs' && (
              <div className="space-y-4 animate-in">
                <div className="flex justify-between items-center px-1">
                  <h2 className="font-bold text-[#e5e5e5] flex gap-2 items-center text-lg"><Icon name="Bell" className="text-[#d4af37]" size={20}/> Ë®äÊÅØ‰∏≠ÂøÉ</h2>
                  <button onClick={() => { if(confirm('Ê∏ÖÈô§ÊâÄÊúâÈÄöÁü•Ôºü')) notifications.forEach(n => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'notifications', n.id))); }} className="text-[10px] text-[#555] font-bold underline italic tracking-tighter uppercase">Clear All</button>
                </div>
                {notifications.map(n => (
                  <div key={n.id} className={`p-6 bg-[#1e1e1e] border relative transition-all shadow-lg ${n.readBy?.includes(user.uid) ? 'opacity-40 border-transparent' : 'border-[#d4af37]/30'}`}>
                    <button onClick={() => deleteItem('notifications', n.id, n.title)} className="absolute top-5 right-5 text-[#444] hover:text-red-500 transition-colors"><Icon name="Trash2" size={16} /></button>
                    <p className="font-bold text-sm text-[#e5e5e5] pr-8">{n.title}</p>
                    <p className="text-xs text-[#a3a3a3] mt-2 leading-relaxed font-light">{n.body}</p>
                  </div>
                ))}
              </div>
            )}

            {/* 4. ÁÆ°ÁêÜÂàÜÈ†Å */}
            {activeTab === 'admin' && isAdmin && (
              <div className="space-y-6 pb-10 animate-in">
                <div className="bg-gradient-to-r from-[#111] to-[#222] p-6 text-white shadow-lg border border-[#333] relative overflow-hidden">
                  <h2 className="text-sm font-bold flex gap-2 items-center mb-4 text-[#d4af37]"><Icon name="Chart" size={18}/> ÁáüÈÅãÂ†±Ë°®</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-[#000]/30 p-4 border border-[#333]">
                      <p className="text-[9px] font-bold text-[#666] uppercase tracking-widest mb-1">Á∏ΩÁôºË°å</p>
                      <p className="text-2xl font-bold text-[#e5e5e5]">{stats.totalIssued}</p>
                    </div>
                    <div className="bg-[#000]/30 p-4 border border-[#333]">
                      <p className="text-[9px] font-bold text-[#666] uppercase tracking-widest mb-1">Á∏ΩÂõûÊî∂</p>
                      <p className="text-2xl font-bold text-[#e5e5e5]">{stats.totalRedeemed}</p>
                    </div>
                  </div>
                  <button onClick={updateAnnounce} className="w-full mt-4 bg-[#333] py-2 text-[10px] font-bold transition-all hover:bg-[#444]">‰øÆÊîπË∑ëÈ¶¨Ááà</button>
                </div>

                <div className="bg-[#1e1e1e] p-7 border border-red-900/30 shadow-xl space-y-4">
                  <h3 className="font-bold text-red-500 mb-4 flex gap-2 items-center text-sm"><Icon name="Alert" size={18}/> Êá≤ÁΩ∞Êâ£Èªû</h3>
                  <div className="space-y-4">
                    <input className="w-full bg-[#121212] border border-[#333] p-4 text-sm font-light outline-none focus:border-red-500 text-white" placeholder="Êâ£ÂàÜÂéüÂõ†" value={penaltyDesc} onChange={(e) => setPenaltyDesc(e.target.value)} />
                    <input type="number" className="w-full bg-[#121212] border border-[#333] p-4 text-sm font-light outline-none focus:border-red-500 text-white" placeholder="ÈªûÊï∏ (Ê≠£Êï∏)" value={penaltyAmount} onChange={(e) => setPenaltyAmount(e.target.value)} />
                    <button onClick={handleDeductPoints} disabled={isProcessing} className="w-full py-4 bg-red-600 text-white font-bold text-xs shadow-lg active:scale-95">Âü∑Ë°åÊâ£Èªû</button>
                  </div>
                </div>

                <div className="space-y-4">
                  <h3 className="text-[9px] font-bold text-[#666] px-3 uppercase tracking-[0.2em]">ÂæÖÊ†∏ÂáÜÈ†ÖÁõÆ</h3>
                  {submissions.filter(s => s.status === 'pending').map(sub => (
                    <div key={sub.id} className="bg-[#1e1e1e] p-6 border border-[#333] shadow-lg">
                      {sub.image && <div className="w-full h-44 mb-5 overflow-hidden bg-[#121212] border border-[#333]"><img src={sub.image} className="w-full h-full object-cover" /></div>}
                      <p className="text-sm font-bold text-[#e5e5e5] mb-6 leading-relaxed text-center font-light italic">„Äå{sub.description}„Äç</p>
                      <div className="flex items-center gap-4 mb-6 bg-[#121212] p-4">
                        <span className="text-xs font-bold text-[#666] shrink-0 uppercase tracking-tighter">Áµ¶‰∫àÈªûÊï∏:</span>
                        <input type="number" className="w-full bg-[#1e1e1e] border-none px-4 py-2 text-sm font-bold text-[#d4af37] outline-none text-center" placeholder="10" value={approvalPoints[sub.id] || ''} onChange={(e) => setApprovalPoints({ ...approvalPoints, [sub.id]: e.target.value })} />
                      </div>
                      <div className="flex gap-3">
                        <button onClick={() => deleteItem('submissions', sub.id, sub.description)} className="flex-1 py-3 bg-[#333] text-[#888] text-[10px] font-bold">ÊãíÁµï</button>
                        <button onClick={() => handleApprove(sub, approvalPoints[sub.id] || 10)} disabled={isProcessing} className="flex-[2.5] btn-action text-[10px] tracking-widest">Á¢∫Ë™çÁôºÊîæ</button>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="bg-[#1e1e1e] p-7 border border-[#333] space-y-4 shadow-lg">
                  <h3 className="text-sm font-bold text-[#e5e5e5] flex items-center gap-2"><Icon name="Plus" size={18} className="text-[#d4af37]"/> ‰∏äÊû∂Êñ∞ÂïÜÂìÅ</h3>
                  <div className="space-y-4">
                    <input className="w-full bg-[#121212] border border-[#333] p-4 text-sm font-light outline-none focus:border-[#d4af37] text-white" placeholder="ÂïÜÂìÅÂêçÁ®±" value={adminRewardName} onChange={(e) => setAdminRewardName(e.target.value)} />
                    <input type="number" className="w-full bg-[#121212] border border-[#333] p-4 text-sm font-light outline-none focus:border-[#d4af37] text-white" placeholder="Ë®≠ÂÆöÈªûÊï∏" value={adminRewardCost} onChange={(e) => setAdminRewardCost(e.target.value)} />
                    <input type="file" accept="image/*" className="text-[10px] block w-full text-[#666]" onChange={(e) => setAdminRewardImage(e.target.files[0])} />
                    <button onClick={handleAddRewardByAdmin} disabled={isAddingReward} className="w-full py-3.5 btn-action font-bold text-xs">‰∏äÊû∂</button>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Â∫ïÈÉ®Â∞éËà™ */}
          <div className="fixed bottom-0 left-0 right-0 bg-[#121212]/95 backdrop-blur-md border-t border-[#333] px-6 py-5 flex justify-between items-center text-[10px] font-bold text-[#555] max-w-md mx-auto z-50">
            <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1.5 transition-all ${activeTab === 'home' ? 'text-[#d4af37] scale-110' : 'hover:text-[#888]'}`}>
              <Icon name="Camera" size={24} className={activeTab === 'home' ? 'stroke-[2px]' : ''}/>
              <span>ÈõÜÈªû</span>
            </button>
            <button onClick={() => setActiveTab('rewards')} className={`flex flex-col items-center gap-1.5 transition-all ${activeTab === 'rewards' ? 'text-[#d4af37] scale-110' : 'hover:text-[#888]'}`}>
              <Icon name="Gift" size={24} className={activeTab === 'rewards' ? 'stroke-[2px]' : ''}/>
              <span>ÂÖåÊèõ</span>
            </button>
            <button onClick={() => setActiveTab('lottery')} className={`flex flex-col items-center gap-1.5 transition-all ${activeTab === 'lottery' ? 'text-[#d4af37] scale-110' : 'hover:text-[#888]'}`}>
              <Icon name="Dice" size={24} className={activeTab === 'lottery' ? 'stroke-[2px]' : ''}/>
              <span>ÊäΩÁçé</span>
            </button>
            <button onClick={() => setActiveTab('notifs')} className={`flex flex-col items-center gap-1.5 transition-all ${activeTab === 'notifs' ? 'text-[#d4af37] scale-110' : 'hover:text-[#888]'}`}>
              <div className="relative">
                <Icon name="Bell" size={24} className={activeTab === 'notifs' ? 'stroke-[2px]' : ''}/>
                {unreadCountReal > 0 && <span className="absolute -top-1 -right-1 bg-red-600 w-2.5 h-2.5 rounded-none border border-[#121212]"></span>}
              </div>
              <span>ÈÄöÁü•</span>
            </button>
            {isAdmin && (
              <button onClick={() => setActiveTab('admin')} className={`flex flex-col items-center gap-1.5 transition-all ${activeTab === 'admin' ? 'text-[#d4af37] scale-110' : 'hover:text-[#888]'}`}>
                <Icon name={isAdmin ? "LogOut" : "Lock"} size={24} className={activeTab === 'admin' ? 'stroke-[2px]' : ''}/>
                <span>ÁÆ°ÁêÜ</span>
              </button>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
